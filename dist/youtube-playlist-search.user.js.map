{"version":3,"file":"youtube-playlist-search.user.js","mappings":"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","sources":["webpack://userscripts/./src/youtube-playlist-search/youtube-playlist-search.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         YouTube Playlist Search\r\n// @namespace    http://www.fuzetsu.com/YPS\r\n// @version      1.1.3\r\n// @description  Allows you to quickly search through youtube playlists\r\n// @match        https://www.youtube.com/*\r\n// @require      https://cdn.rawgit.com/fuzetsu/userscripts/477063e939b9658b64d2f91878da20a7f831d98b/wait-for-elements/wait-for-elements.js\r\n// @copyright    2014+, fuzetsu\r\n// @grant        none\r\n// ==/UserScript==\r\n\r\nconst SCRIPT_NAME = 'YouTube Playlist Search';\r\nconst ITEM_SELECTOR = '#contents > ytd-playlist-video-renderer,ytd-grid-video-renderer';\r\nconst ITEM_PROGRESS_SELECTOR = ITEM_SELECTOR + ' #progress';\r\nconst TEXT_SELECTOR = '#meta';\r\nconst OFFSET_AREA_SELECTOR = '#masthead-container';\r\n\r\nconst util = {\r\n  log: (...args) => console.log(`%c${SCRIPT_NAME}`, 'font-weight: bold;color: hotpink;', ...args),\r\n  q: (query, context) => (context || document).querySelector(query),\r\n  qq: (query, context) => Array.from((context || document).querySelectorAll(query)),\r\n  debounce: (cb, ms) => {\r\n    let id;\r\n    return (...args) => {\r\n      clearTimeout(id);\r\n      id = setTimeout(() => cb(...args), ms);\r\n    };\r\n  },\r\n  makeElem: (tag, attrs) => {\r\n    const elem = document.createElement(tag);\r\n    Object.entries(attrs).forEach(([attr, val]) => !['style'].includes(attr) && attr in elem ? elem[attr] = val : elem.setAttribute(attr, val));\r\n    return elem;\r\n  }\r\n};\r\n\r\nconst yps = {\r\n  _items: [],\r\n  hideWatched: false,\r\n  render: () => {\r\n    const commonStyles = [\r\n      'position: fixed',\r\n      `top: ${util.q(OFFSET_AREA_SELECTOR).clientHeight}px`,\r\n      'z-index: 9000',\r\n      'padding: 5px 8px',\r\n      'border: 1px solid #999',\r\n      'font-size: medium',\r\n      'color: var(--yt-primary-text-color)',\r\n      'margin: 0',\r\n      'box-sizing: border-box',\r\n      'background: var(--yt-main-app-background-tmp)'\r\n    ];\r\n    const txtSearch = util.makeElem('input', {\r\n      type: 'text',\r\n      placeholder: 'filter - start with ^ for inverse search',\r\n      style: [\r\n        ...commonStyles,\r\n        'right: 0',\r\n        'width: 300px'\r\n      ].join(';'),\r\n      onkeyup: util.debounce(e => resultCount.render(...yps.search(e.target.value)), 200)\r\n    });\r\n    const resultCount = util.makeElem('span', {\r\n      style: [\r\n        ...commonStyles,\r\n        'right: 300px'\r\n      ].join(';'),\r\n      textContent: '-'\r\n    });\r\n    resultCount.render = (x, y, invert) => resultCount.childNodes[0].textContent = `Showing ${x} of ${y} ${invert ? '(NOT)' : ''} | Hide Watched `;\r\n    const toggleWatched = util.makeElem('input', {\r\n      type: 'checkbox',\r\n      value: yps.hideWatched,\r\n      onchange: () => (yps.hideWatched = toggleWatched.checked, resultCount.render(...yps.search(txtSearch.value)))\r\n    });\r\n    resultCount.appendChild(toggleWatched);\r\n    [txtSearch, resultCount].forEach(elem => document.body.appendChild(elem));\r\n    return { txtSearch, resultCount };\r\n  },\r\n  search: (query = '') => {\r\n    const invert = query.startsWith('^');\r\n    if(invert) query = query.slice(1);\r\n    query = query.toLowerCase().trim().split(' ').map(q => q.trim()).filter(q => !!q);\r\n    const count = yps._items\r\n      .map(item => {\r\n        const hideBecauseWatched = yps.hideWatched && item.watched;\r\n        let hide = hideBecauseWatched || !query[invert ? 'some' : 'every'](q => item.name.includes(q));\r\n        if(invert && !hideBecauseWatched) hide = !hide;\r\n        item.elem.style.display = hide ? 'none' : '';\r\n        return hide;\r\n      })\r\n      .filter(hide => !hide).length;\r\n    return [count, yps._items.length, invert];\r\n  },\r\n  start: () => {\r\n    util.log('Starting... waiting for playlist');\r\n    waitForUrl(/^https:\\/\\/www\\.youtube\\.com\\/(playlist\\?list=|(user|channel)\\/[^\\/]+\\/videos|feed\\/subscriptions).*/, () => {\r\n      util.log('Reached playlist, adding search box');\r\n      const playlistUrl = location.href;\r\n      const { txtSearch, resultCount } = yps.render();\r\n      const refresh = util.debounce(() => resultCount.render(...yps.search(txtSearch.value)), 50);\r\n      const itemWait = waitForElems({\r\n        sel: ITEM_SELECTOR, \r\n        onmatch: elem => {\r\n          yps._items.push({\r\n            elem,\r\n            name: util.q(TEXT_SELECTOR, elem).textContent.toLowerCase(),\r\n            watched: false\r\n          });\r\n          refresh();\r\n        }\r\n      });\r\n      const progressWait = waitForElems({\r\n        sel: ITEM_PROGRESS_SELECTOR, \r\n        onmatch: prog => {\r\n          const watched = parseInt(prog.style.width) > 50;\r\n          if(!watched) return;\r\n          const itemElem = prog.closest(ITEM_SELECTOR);\r\n          const found = yps._items.find(item => item.elem === itemElem);\r\n          if(!found) return console.log('error, unable to find item parent', prog, itemElem, found);\r\n          found.watched = watched;\r\n          if(yps.hideWatched && watched) refresh();\r\n        }\r\n      });\r\n      const urlWaitId = waitForUrl(url => url !== playlistUrl, () => {\r\n        util.log('leaving playlist, cleaning up');\r\n        [progressWait, itemWait, urlWaitId].forEach(wait => wait.stop && wait.stop() || clearInterval(wait));\r\n        [txtSearch, resultCount].forEach(elem => elem.remove());\r\n        yps._items = [];\r\n      }, true);\r\n    });\r\n  }\r\n};\r\n\r\nyps.start();\r\n"],"names":["SCRIPT_NAME","ITEM_SELECTOR","ITEM_PROGRESS_SELECTOR","TEXT_SELECTOR","OFFSET_AREA_SELECTOR","util","log","args","console","q","query","context","document","querySelector","qq","Array","from","querySelectorAll","debounce","cb","ms","id","clearTimeout","setTimeout","makeElem","tag","attrs","elem","createElement","Object","entries","forEach","attr","val","includes","setAttribute","yps","_items","hideWatched","render","commonStyles","clientHeight","txtSearch","type","placeholder","style","join","onkeyup","e","resultCount","search","target","value","textContent","x","y","invert","childNodes","toggleWatched","onchange","checked","appendChild","body","startsWith","slice","toLowerCase","trim","split","map","filter","count","item","hideBecauseWatched","watched","hide","name","display","length","start","waitForUrl","playlistUrl","location","href","refresh","itemWait","waitForElems","sel","onmatch","push","progressWait","prog","parseInt","width","itemElem","closest","found","find","urlWaitId","url","wait","stop","clearInterval","remove"],"sourceRoot":""}