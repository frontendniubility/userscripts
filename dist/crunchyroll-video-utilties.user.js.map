{"version":3,"file":"crunchyroll-video-utilties.user.js","mappings":"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","sources":["webpack://userscripts/./src/crunchyroll-video-utilities/crunchyroll-video-utilties.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name Crunchyroll Video Utilities\r\n// @version 1.0.5\r\n// @namespace fuzetsu/csdvqn\r\n// @description seek video with hotkeys and set default quality\r\n// @match https://static.crunchyroll.com/*/player.html\r\n// @match https://www.crunchyroll.com/*\r\n// @grant GM_registerMenuCommand\r\n// @grant GM_getValue\r\n// @grant GM_setValue\r\n// @require https://gitcdn.xyz/cdn/fuzetsu/userscripts/b38eabf72c20fa3cf7da84ecd2cefe0d4a2116be/wait-for-elements/wait-for-elements.js\r\n// @require https://gitcdn.xyz/cdn/kufii/My-UserScripts/fa4555701cf5a22eae44f06d9848df6966788fa8/libs/gm_config.js\r\n// ==/UserScript==\r\n\r\nconst sep = '~~@~~'\r\nconst domain = 'https://www.crunchyroll.com'\r\nconst CSS = {\r\n  quality: '.qualityMenuItemSelector',\r\n  settings: '.settingsMenuButton,#settingsControl',\r\n  playerBox: '#showmedia_video_player'\r\n}\r\n\r\n// use publicly exposed Player.js object to control video player\r\nconst vilosPlayer = () => unsafeWindow.VILOS_PLAYERJS\r\n\r\nconst qq = (q, c) => Array.from((c || document).querySelectorAll(q))\r\nconst q = (q, c) => (c || document).querySelector(q)\r\n\r\nconst config = GM_config([\r\n  {\r\n    key: 'quality',\r\n    label: 'Quality',\r\n    type: 'dropdown',\r\n    values: ['auto', 360, 480, 720, 1080],\r\n    default: 'auto'\r\n  }\r\n])\r\n\r\nlet cfg = config.load()\r\n\r\nconfig.onsave = newCfg => {\r\n  cfg = newCfg\r\n  player.setQuality(cfg.quality)\r\n}\r\n\r\nconst p = (...args) => (console.log(...args), args[0])\r\n\r\nlet isFullscreen = false\r\n\r\nconst player = {\r\n  setQuality: quality => {\r\n    const btn =\r\n      quality !== 'auto'\r\n        ? qq(CSS.quality)\r\n            .slice(2)\r\n            .find(item => quality >= parseInt(item.textContent))\r\n        : qq(CSS.quality)[2]\r\n    if (btn) {\r\n      // this causes the menu to open\r\n      btn.click()\r\n      // so close it after a short delay\r\n      setTimeout(player.toggleSettings, 200, false)\r\n    }\r\n  },\r\n  fillTab: () => {\r\n    const playerBox = q(CSS.playerBox)\r\n    if (!playerBox) return p('playerbox not found')\r\n    isFullscreen = !isFullscreen\r\n    if (!isFullscreen) return playerBox.removeAttribute('style')\r\n    Object.assign(playerBox.style, {\r\n      position: 'fixed',\r\n      zIndex: 1000,\r\n      top: 0,\r\n      bottom: 0,\r\n      left: 0,\r\n      right: 0,\r\n      width: '100%',\r\n      height: '100%'\r\n    })\r\n  },\r\n  nextEp: (back = false) =>\r\n    q('.collection-carousel-media-link-current')\r\n      .parentElement[back ? 'previousElementSibling' : 'nextElementSibling'].querySelector('a')\r\n      .click(),\r\n  prevEp: () => player.nextEp(true),\r\n  skip: sec => vilosPlayer().getCurrentTime(curTime => vilosPlayer().setCurrentTime(curTime + sec)),\r\n  volumeUp: (val = 10) => vilosPlayer().getVolume(curVol => vilosPlayer().setVolume(curVol + val)),\r\n  volumeDown: (val = -10) => player.volumeUp(val),\r\n  toggleSettings: makeVisible => {\r\n    const btn = q(CSS.settings)\r\n    if (typeof makeVisible === 'boolean') {\r\n      const isVisible = p(!!btn.offSetParent, '=== isVisible')\r\n      if (makeVisible === isVisible) return\r\n    }\r\n    btn.click()\r\n  }\r\n}\r\n\r\nconst seekKeys = {\r\n  l: 85,\r\n  b: -85,\r\n  '}': 30,\r\n  '{': -30,\r\n  ']': 15,\r\n  '[': -15\r\n}\r\n\r\nconst handleKey = key =>\r\n  key === 'n'\r\n    ? player.nextEp()\r\n    : key === 'p'\r\n    ? player.prevEp()\r\n    : key === 'j'\r\n    ? player.volumeDown()\r\n    : key === 'k'\r\n    ? player.volumeUp()\r\n    : key === 'w'\r\n    ? player.fillTab()\r\n    : key in seekKeys\r\n    ? player.skip(seekKeys[key])\r\n    : null\r\n\r\nconst isPlayerFrame = location.href.includes('static.crunchyroll.com')\r\n\r\n/**\r\n * Keyboard events from within the player frame dont bubble up to main page where the player.js\r\n * object and the video links live, so use postMessage to send the keypresses there\r\n **/\r\nconst pass = ['INPUT', 'TEXTAREA', 'SELECT']\r\nwindow.addEventListener(\r\n  'keydown',\r\n  isPlayerFrame\r\n    ? e => window.parent.postMessage(sep + e.key, domain)\r\n    : e => pass.includes(document.activeElement.nodeName) || handleKey(e.key)\r\n)\r\n\r\nif (isPlayerFrame) {\r\n  // can only set quality from the player frame since the button is in its dom\r\n  waitForElems({\r\n    stop: true,\r\n    sel: CSS.quality + '.selected',\r\n    onmatch: elem => {\r\n      if (elem.textContent.toLowerCase().includes(cfg.quality))\r\n        return p('configured default already selected')\r\n      player.setQuality(cfg.quality)\r\n    }\r\n  })\r\n} else {\r\n  // handle forwarded keyboard from player frame\r\n  window.addEventListener(\r\n    'message',\r\n    ({ data }) => data.startsWith(sep) && handleKey(data.slice(sep.length))\r\n  )\r\n}\r\n\r\nGM_registerMenuCommand('Crunchyroll Video Utilities - Config', config.setup)\r\n"],"names":["sep","domain","CSS","quality","settings","playerBox","vilosPlayer","unsafeWindow","VILOS_PLAYERJS","qq","q","c","Array","from","document","querySelectorAll","querySelector","config","GM_config","key","label","type","values","cfg","load","onsave","newCfg","player","setQuality","p","_console","console","log","apply","arguments","length","undefined","isFullscreen","btn","slice","find","item","parseInt","textContent","click","setTimeout","toggleSettings","fillTab","removeAttribute","Object","assign","style","position","zIndex","top","bottom","left","right","width","height","nextEp","back","parentElement","prevEp","skip","sec","getCurrentTime","curTime","setCurrentTime","volumeUp","val","getVolume","curVol","setVolume","volumeDown","makeVisible","isVisible","offSetParent","seekKeys","l","b","handleKey","isPlayerFrame","location","href","includes","pass","window","addEventListener","e","parent","postMessage","activeElement","nodeName","waitForElems","stop","sel","onmatch","elem","toLowerCase","_ref","data","startsWith","GM_registerMenuCommand","setup"],"sourceRoot":""}