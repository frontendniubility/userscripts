{"version":3,"file":"crunchyroll-queue-times.user.js","mappings":"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","sources":["webpack://userscripts/./src/crunchyroll-queue-times/crunchyroll-queue-times.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name        Crunchyroll Queue Real Times\r\n// @namespace   http://www.fuzetsu.com/CRRT\r\n// @version     1.0.4\r\n// @description Display countdown until next episode in the Crunchyroll Queue page\r\n// @match       http://www.crunchyroll.com/home/queue\r\n// @copyright   2014+, fuzetsu\r\n// @deprecated  true\r\n// ==/UserScript==\r\n\r\nvar PREMIUM = 'rgb(255, 251, 223)',\r\n  REGULAR = 'rgb(232, 244, 248)',\r\n  COMING_SOON_IMG = 'http://static.ak.crunchyroll.com/i/coming_soon_beta_wide.jpg';\r\n\r\nvar SECOND = 1000,\r\n  MINUTE = SECOND * 60,\r\n  HOUR = MINUTE * 60,\r\n  DAY = HOUR * 24;\r\n\r\nvar CURYEAR = (new Date()).getFullYear();\r\n\r\nvar qq = function(q, c) {\r\n  return [].slice.call((c || document).querySelectorAll(q));\r\n};\r\n\r\nvar storeGet = function(key) {\r\n  if (typeof GM_getValue === \"undefined\") {\r\n    var value = localStorage.getItem(key);\r\n    if (value === \"true\" || value === \"false\") {\r\n      return (value === \"true\") ? true : false;\r\n    }\r\n    return value;\r\n  }\r\n  return GM_getValue(key);\r\n};\r\n\r\nvar storeSet = function(key, value) {\r\n  if (typeof GM_setValue === \"undefined\") {\r\n    return localStorage.setItem(key, value);\r\n  }\r\n  return GM_setValue(key, value);\r\n};\r\n\r\nvar storeDel = function(key) {\r\n  if (typeof GM_deleteValue === \"undefined\") {\r\n    return localStorage.removeItem(key);\r\n  }\r\n  return GM_deleteValue(key);\r\n};\r\n\r\nvar findEpByTitle = function(shows, title) {\r\n  var found;\r\n  shows.some(function(show) {\r\n    if (show.name.indexOf(title) === 0) {\r\n      found = show;\r\n      return true;\r\n    }\r\n  });\r\n  return found;\r\n};\r\n\r\nvar getTimes = function(total) {\r\n  var days = Math.floor(total / DAY);\r\n  total -= days * DAY;\r\n  var hours = Math.floor(total / HOUR);\r\n  total -= hours * HOUR;\r\n  var minutes = Math.floor(total / MINUTE);\r\n  total -= minutes * MINUTE;\r\n  var seconds = Math.floor(total / SECOND);\r\n  total -= seconds * SECOND;\r\n  return {\r\n    days: days,\r\n    hours: hours,\r\n    minutes: minutes,\r\n    seconds: seconds,\r\n    isDone: function() {\r\n      return days <= 0 && hours <= 0 && minutes <= 0 && seconds <= 0;\r\n    },\r\n    toTimeStr: function() {\r\n      return (this.days > 0 ? this.days + ' days ' : '') + (this.hours > 0 ? this.hours + ' hours ' : '') + (this.minutes > 0 ? this.minutes + ' minutes ' : '') + this.seconds + ' seconds';\r\n    }\r\n  };\r\n};\r\n\r\n// inserts a countdown to the release\r\nvar insertCountDown = function(loc, ep) {\r\n  var countDown = document.createElement('span');\r\n  var last = Date.now();\r\n  var totalTime = ep.date.valueOf() - last;\r\n  var tick = setInterval(function() {\r\n    var times = getTimes(totalTime);\r\n    if (times.isDone()) {\r\n      countDown.innerHTML = '<strong>A new episode has been released! Refresh the page to see it.</strong>';\r\n      return clearInterval(tick);\r\n    }\r\n    countDown.textContent = times.toTimeStr();\r\n    totalTime -= Date.now() - last;\r\n    last = Date.now();\r\n  }, 1000);\r\n  loc.innerHTML = '';\r\n  loc.appendChild(countDown);\r\n};\r\n\r\nvar extractDataFromScript = function(text) {\r\n  var obj = JSON.parse(text.slice(text.indexOf('{'), text.lastIndexOf('}') + 1));\r\n  var dateStr = text.slice(text.lastIndexOf('}') + 4, text.lastIndexOf('\"'));\r\n  obj.date = new Date(dateStr.slice(0, -1) + \" \" + (dateStr.slice(-1) === 'a' ? 'am' : 'pm') + ' ' + CURYEAR);\r\n  return obj;\r\n};\r\n\r\nvar getLaunchCalendar = function(cb) {\r\n  var xhr = new XMLHttpRequest();\r\n  xhr.open('get', '/launchcalendar', true);\r\n  xhr.responseType = 'document';\r\n  xhr.onload = cb;\r\n  xhr.send();\r\n};\r\n\r\nvar main = function(userColor) {\r\n  console.log(userColor);\r\n  getLaunchCalendar(function(evt) {\r\n    var xhr = evt.target;\r\n    var animeData = [];\r\n    qq('td > div > script', xhr.response).forEach(function(script) {\r\n      if (script.previousSibling.previousSibling.style.backgroundColor !== userColor) return;\r\n      animeData.push(extractDataFromScript(script.textContent.trim()));\r\n    });\r\n    // find first date that is before now\r\n    var now = Date.now();\r\n    animeData = animeData.filter(function(anime) {\r\n      return anime.date.valueOf() >= now;\r\n    });\r\n    // add retrieved data to page\r\n    qq('.queue-wrapper').forEach(function(queueItem) {\r\n      if (qq('.episode-img img', queueItem)[0].src !== COMING_SOON_IMG) {\r\n        return;\r\n      }\r\n      var title = qq('.series-title', queueItem)[0].textContent;\r\n      var episode = findEpByTitle(animeData, title);\r\n      if (episode) {\r\n        insertCountDown(qq('.short-desc', queueItem)[0], episode);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nvar user_premium = storeGet('CQRT_user_premium');\r\n\r\nif (user_premium === undefined) {\r\n  user_premium = true;\r\n}\r\n\r\n// register menu command\r\ntypeof GM_registerMenuCommand === 'function' && GM_registerMenuCommand('CR Queue countdown: show schedule for ' + (user_premium ? 'PREMIUM' : 'REGULAR') + ' users', function() {\r\n  storeSet('CQRT_user_premium', !user_premium);\r\n  window.location.reload();\r\n});\r\n\r\n// kick it off\r\nmain(user_premium && PREMIUM || REGULAR);\r\n"],"names":["PREMIUM","REGULAR","COMING_SOON_IMG","SECOND","MINUTE","HOUR","DAY","CURYEAR","Date","getFullYear","qq","q","c","slice","call","document","querySelectorAll","storeGet","key","GM_getValue","value","localStorage","getItem","storeSet","GM_setValue","setItem","storeDel","GM_deleteValue","removeItem","findEpByTitle","shows","title","found","some","show","name","indexOf","getTimes","total","days","Math","floor","hours","minutes","seconds","isDone","toTimeStr","insertCountDown","loc","ep","countDown","createElement","last","now","totalTime","date","valueOf","tick","setInterval","times","innerHTML","clearInterval","textContent","appendChild","extractDataFromScript","text","obj","JSON","parse","lastIndexOf","dateStr","getLaunchCalendar","cb","xhr","XMLHttpRequest","open","responseType","onload","send","main","userColor","console","log","evt","target","animeData","response","forEach","script","previousSibling","style","backgroundColor","push","trim","filter","anime","queueItem","src","episode","user_premium","undefined","GM_registerMenuCommand","window","location","reload"],"sourceRoot":""}