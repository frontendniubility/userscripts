{"version":3,"file":"youtube-history-management.user.js","mappings":"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","sources":["webpack://userscripts/./src/youtube-history-management/youtube-history-management.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         YouTube History Management\r\n// @namespace    http://fuzetsu.com/YHM\r\n// @version      1.1.0\r\n// @description  Select and remove YouTube history items quickly\r\n// @author       fuzetsu\r\n// @match        *://www.youtube.com/*\r\n// @grant        none\r\n// @require      https://greasyfork.org/scripts/5679-wait-for-elements/code/Wait%20For%20Elements.js?version=141779\r\n// @noframes\r\n// @deprecated   true\r\n// ==/UserScript==\r\n\r\n\r\n(function () {\r\n  if (window.top !== window.self)\r\n    return;\r\n\r\n  var deleteQueue = [],\r\n    items = [],\r\n    itemIdx = 0,\r\n    waitID = null,\r\n    EDIT_MODE = false,\r\n    SCRIPT_NAME = 'YouTube History Management',\r\n    SELECT_COLOR = 'orange',\r\n    TITLE_SELECTOR = '.yt-uix-tile-link',\r\n    DESC_SELECTOR = '.yt-lockup-description',\r\n    MENU_SELECTOR = '#browse-items-primary li > ul',\r\n    FEED_SELECTOR = '.yt-lockup-video';\r\n\r\n  var Util = {\r\n    log: function () {\r\n      var args = [].slice.call(arguments);\r\n      args.unshift('%c' + SCRIPT_NAME + ':', 'font-weight: bold;color:navy');\r\n      console.log.apply(console, args);\r\n    },\r\n    q: function (query, context) {\r\n      return (context || document).querySelector(query);\r\n    },\r\n    qq: function (query, context) {\r\n      return [].slice.call((context || document).querySelectorAll(query));\r\n    },\r\n    _cbQueue: [],\r\n    _handleQueue: function () {\r\n      this._cbQueue.shift()();\r\n    },\r\n    queueCallback: function (callback) {\r\n      this._cbQueue.push(callback);\r\n      setTimeout(this._handleQueue.bind(this), 0);\r\n    }\r\n  };\r\n\r\n  function removeItem(item) {\r\n    // find \"remove from watch history\" button within history item\r\n    var btns = Util.qq('button', item);\r\n    btns.some(function (btn) {\r\n      // make sure we have the right button\r\n      if (btn.title.trim() === 'Remove from Watch history') {\r\n        Util.queueCallback(btn.click.bind(btn));\r\n        toggleSelected(item, false, true);\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n\r\n  function toggleUntil(index, item) {\r\n    while (item && !item.dataset.yhmSelected) {\r\n      toggleSelected(item, true);\r\n      item = items[--index];\r\n    }\r\n  }\r\n\r\n  function toggleSelected(item, state, ignore) {\r\n    var title = Util.q(TITLE_SELECTOR, item),\r\n      desc = Util.q(DESC_SELECTOR, item);\r\n    if (state || !item.dataset.yhmSelected) {\r\n      if (!ignore) {\r\n        deleteQueue.push(item);\r\n      }\r\n      item.style.backgroundColor = SELECT_COLOR;\r\n      title && (title.style.backgroundColor = SELECT_COLOR);\r\n      desc && (desc.style.backgroundColor = SELECT_COLOR);\r\n      item.dataset.yhmSelected = 'yes';\r\n    } else {\r\n      if (!ignore) {\r\n        deleteQueue.splice(deleteQueue.indexOf(item), 1);\r\n      }\r\n      item.style.backgroundColor = '';\r\n      title && (title.style.backgroundColor = '');\r\n      desc && (desc.style.backgroundColor = '');\r\n      item.dataset.yhmSelected = '';\r\n    }\r\n  }\r\n\r\n  function makeMenuButton(text, action) {\r\n    var btn = document.createElement('button'),\r\n      liContainer = document.createElement('li');\r\n    btn.className = 'yt-uix-button yt-uix-button-size-default yt-uix-button-default';\r\n    btn.innerHTML = '<span class=\"yt-uix-button-content\">' + text + '</span>';\r\n    btn.addEventListener('click', action, false);\r\n    liContainer.appendChild(btn);\r\n    Util.q(MENU_SELECTOR).appendChild(liContainer);\r\n    return btn;\r\n  }\r\n\r\n  Util.log('Started');\r\n\r\n  waitForUrl(/^http(s)?:\\/\\/www\\.youtube\\.com\\/feed\\/history/, function () {\r\n    var historyUrl = location.href;\r\n    Util.log('Entered history page, waiting for menu area to load');\r\n    waitForElems(MENU_SELECTOR, function () {\r\n      Util.log('Found menu area, creating and inserting buttons');\r\n      // Button that toggles between edit and standard modes\r\n      var btnEditHistory = makeMenuButton('Edit History', function (evt) {\r\n        if (this.textContent === 'Edit History') {\r\n          EDIT_MODE = true;\r\n          this.textContent = 'Stop Editing';\r\n          btnDeleteSelected.parentNode.style.display = '';\r\n        } else {\r\n          EDIT_MODE = false;\r\n          this.textContent = 'Edit History';\r\n          // reset history selection\r\n          while (deleteQueue.length > 0) {\r\n            toggleSelected(deleteQueue.pop(), false, true);\r\n          }\r\n          btnDeleteSelected.parentNode.style.display = 'none';\r\n        }\r\n      });\r\n      // Button that deletes all selected items, only visible while editing\r\n      var btnDeleteSelected = makeMenuButton('Delete Selected', function (evt) {\r\n        var count = deleteQueue.length;\r\n        if (count < 1) return alert('Nothing selected, select at least one history item and try again.');\r\n        EDIT_MODE = false;\r\n        while (deleteQueue.length > 0) {\r\n          removeItem(deleteQueue.pop());\r\n        }\r\n        Util.queueCallback(function () {\r\n          EDIT_MODE = true;\r\n        });\r\n        alert('Deleted ' + count + ' history items.');\r\n      });\r\n      // hide the button pre-emptively\r\n      btnDeleteSelected.parentNode.style.display = 'none';\r\n\r\n      // watch DOM for new history items\r\n      waitID = waitForElems(FEED_SELECTOR, function (item) {\r\n        var index = itemIdx;\r\n        itemIdx += 1;\r\n        items.push(item);\r\n        // bind selecting event for history items\r\n        item.addEventListener('click', function (evt) {\r\n          if (EDIT_MODE) {\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n            if (evt.shiftKey) {\r\n              toggleUntil(index, item);\r\n            } else {\r\n              toggleSelected(item);\r\n            }\r\n            window.getSelection().removeAllRanges();\r\n          }\r\n        }, false);\r\n      });\r\n    }, true);\r\n    waitForUrl(function (url) {\r\n      return url !== historyUrl;\r\n    }, function () {\r\n      clearInterval(waitID);\r\n      EDIT_MODE = false;\r\n      deleteQueue = [];\r\n      Util.log('Leaving history page, cleaning up listeners and references');\r\n    }, true);\r\n  });\r\n})();"],"names":["window","top","self","deleteQueue","items","itemIdx","waitID","EDIT_MODE","SCRIPT_NAME","SELECT_COLOR","TITLE_SELECTOR","DESC_SELECTOR","MENU_SELECTOR","FEED_SELECTOR","Util","log","args","slice","call","arguments","unshift","console","apply","q","query","context","document","querySelector","qq","querySelectorAll","_cbQueue","_handleQueue","shift","queueCallback","callback","push","setTimeout","bind","removeItem","item","btns","some","btn","title","trim","click","toggleSelected","toggleUntil","index","dataset","yhmSelected","state","ignore","desc","style","backgroundColor","splice","indexOf","makeMenuButton","text","action","createElement","liContainer","className","innerHTML","addEventListener","appendChild","waitForUrl","historyUrl","location","href","waitForElems","btnEditHistory","evt","textContent","btnDeleteSelected","parentNode","display","length","pop","count","alert","preventDefault","stopPropagation","shiftKey","getSelection","removeAllRanges","url","clearInterval"],"sourceRoot":""}