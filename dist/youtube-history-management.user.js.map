{"version":3,"file":"youtube-history-management.user.js","mappings":"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","sources":["webpack://userscripts/./src/youtube-history-management/youtube-history-management.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         YouTube History Management\r\n// @namespace    http://fuzetsu.com/YHM\r\n// @version      1.1.0\r\n// @description  Select and remove YouTube history items quickly\r\n// @author       fuzetsu\r\n// @match        *://www.youtube.com/*\r\n// @grant        none\r\n// @require      https://greasyfork.org/scripts/5679-wait-for-elements/code/Wait%20For%20Elements.js?version=141779\r\n// @noframes\r\n// @deprecated   true\r\n// ==/UserScript==\r\n\r\n\r\n(function () {\r\n  if (window.top !== window.self)\r\n    return;\r\n\r\n  var deleteQueue = [],\r\n    items = [],\r\n    itemIdx = 0,\r\n    waitID = null,\r\n    EDIT_MODE = false,\r\n    SCRIPT_NAME = 'YouTube History Management',\r\n    SELECT_COLOR = 'orange',\r\n    TITLE_SELECTOR = '.yt-uix-tile-link',\r\n    DESC_SELECTOR = '.yt-lockup-description',\r\n    MENU_SELECTOR = '#browse-items-primary li > ul',\r\n    FEED_SELECTOR = '.yt-lockup-video';\r\n\r\n  var Util = {\r\n    log: function () {\r\n      var args = [].slice.call(arguments);\r\n      args.unshift('%c' + SCRIPT_NAME + ':', 'font-weight: bold;color:navy');\r\n      console.log.apply(console, args);\r\n    },\r\n    q: function (query, context) {\r\n      return (context || document).querySelector(query);\r\n    },\r\n    qq: function (query, context) {\r\n      return [].slice.call((context || document).querySelectorAll(query));\r\n    },\r\n    _cbQueue: [],\r\n    _handleQueue: function () {\r\n      this._cbQueue.shift()();\r\n    },\r\n    queueCallback: function (callback) {\r\n      this._cbQueue.push(callback);\r\n      setTimeout(this._handleQueue.bind(this), 0);\r\n    }\r\n  };\r\n\r\n  function removeItem(item) {\r\n    // find \"remove from watch history\" button within history item\r\n    var btns = Util.qq('button', item);\r\n    btns.some(function (btn) {\r\n      // make sure we have the right button\r\n      if (btn.title.trim() === 'Remove from Watch history') {\r\n        Util.queueCallback(btn.click.bind(btn));\r\n        toggleSelected(item, false, true);\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n\r\n  function toggleUntil(index, item) {\r\n    while (item && !item.dataset.yhmSelected) {\r\n      toggleSelected(item, true);\r\n      item = items[--index];\r\n    }\r\n  }\r\n\r\n  function toggleSelected(item, state, ignore) {\r\n    var title = Util.q(TITLE_SELECTOR, item),\r\n      desc = Util.q(DESC_SELECTOR, item);\r\n    if (state || !item.dataset.yhmSelected) {\r\n      if (!ignore) {\r\n        deleteQueue.push(item);\r\n      }\r\n      item.style.backgroundColor = SELECT_COLOR;\r\n      title && (title.style.backgroundColor = SELECT_COLOR);\r\n      desc && (desc.style.backgroundColor = SELECT_COLOR);\r\n      item.dataset.yhmSelected = 'yes';\r\n    } else {\r\n      if (!ignore) {\r\n        deleteQueue.splice(deleteQueue.indexOf(item), 1);\r\n      }\r\n      item.style.backgroundColor = '';\r\n      title && (title.style.backgroundColor = '');\r\n      desc && (desc.style.backgroundColor = '');\r\n      item.dataset.yhmSelected = '';\r\n    }\r\n  }\r\n\r\n  function makeMenuButton(text, action) {\r\n    var btn = document.createElement('button'),\r\n      liContainer = document.createElement('li');\r\n    btn.className = 'yt-uix-button yt-uix-button-size-default yt-uix-button-default';\r\n    btn.innerHTML = '<span class=\"yt-uix-button-content\">' + text + '</span>';\r\n    btn.addEventListener('click', action, false);\r\n    liContainer.appendChild(btn);\r\n    Util.q(MENU_SELECTOR).appendChild(liContainer);\r\n    return btn;\r\n  }\r\n\r\n  Util.log('Started');\r\n\r\n  waitForUrl(/^http(s)?:\\/\\/www\\.youtube\\.com\\/feed\\/history/, function () {\r\n    var historyUrl = location.href;\r\n    Util.log('Entered history page, waiting for menu area to load');\r\n    waitForElems(MENU_SELECTOR, function () {\r\n      Util.log('Found menu area, creating and inserting buttons');\r\n      // Button that toggles between edit and standard modes\r\n      var btnEditHistory = makeMenuButton('Edit History', function (evt) {\r\n        if (this.textContent === 'Edit History') {\r\n          EDIT_MODE = true;\r\n          this.textContent = 'Stop Editing';\r\n          btnDeleteSelected.parentNode.style.display = '';\r\n        } else {\r\n          EDIT_MODE = false;\r\n          this.textContent = 'Edit History';\r\n          // reset history selection\r\n          while (deleteQueue.length > 0) {\r\n            toggleSelected(deleteQueue.pop(), false, true);\r\n          }\r\n          btnDeleteSelected.parentNode.style.display = 'none';\r\n        }\r\n      });\r\n      // Button that deletes all selected items, only visible while editing\r\n      var btnDeleteSelected = makeMenuButton('Delete Selected', function (evt) {\r\n        var count = deleteQueue.length;\r\n        if (count < 1) return alert('Nothing selected, select at least one history item and try again.');\r\n        EDIT_MODE = false;\r\n        while (deleteQueue.length > 0) {\r\n          removeItem(deleteQueue.pop());\r\n        }\r\n        Util.queueCallback(function () {\r\n          EDIT_MODE = true;\r\n        });\r\n        alert('Deleted ' + count + ' history items.');\r\n      });\r\n      // hide the button pre-emptively\r\n      btnDeleteSelected.parentNode.style.display = 'none';\r\n\r\n      // watch DOM for new history items\r\n      waitID = waitForElems(FEED_SELECTOR, function (item) {\r\n        var index = itemIdx;\r\n        itemIdx += 1;\r\n        items.push(item);\r\n        // bind selecting event for history items\r\n        item.addEventListener('click', function (evt) {\r\n          if (EDIT_MODE) {\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n            if (evt.shiftKey) {\r\n              toggleUntil(index, item);\r\n            } else {\r\n              toggleSelected(item);\r\n            }\r\n            window.getSelection().removeAllRanges();\r\n          }\r\n        }, false);\r\n      });\r\n    }, true);\r\n    waitForUrl(function (url) {\r\n      return url !== historyUrl;\r\n    }, function () {\r\n      clearInterval(waitID);\r\n      EDIT_MODE = false;\r\n      deleteQueue = [];\r\n      Util.log('Leaving history page, cleaning up listeners and references');\r\n    }, true);\r\n  });\r\n})();"],"names":["window","top","self","deleteQueue","items","itemIdx","waitID","EDIT_MODE","SCRIPT_NAME","SELECT_COLOR","MENU_SELECTOR","Util","log","args","slice","call","arguments","unshift","console","apply","q","query","context","document","querySelector","qq","querySelectorAll","_cbQueue","_handleQueue","this","shift","queueCallback","callback","push","setTimeout","bind","waitForUrl","historyUrl","location","href","waitForElems","makeMenuButton","evt","textContent","btnDeleteSelected","parentNode","style","display","length","toggleSelected","pop","count","alert","removeItem","item","index","addEventListener","preventDefault","stopPropagation","shiftKey","dataset","yhmSelected","toggleUntil","getSelection","removeAllRanges","url","clearInterval","some","btn","title","trim","click","state","ignore","desc","backgroundColor","splice","indexOf","text","action","createElement","liContainer","className","innerHTML","appendChild"],"sourceRoot":""}