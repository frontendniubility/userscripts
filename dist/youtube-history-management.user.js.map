{"version":3,"file":"youtube-history-management.user.js","mappings":"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","sources":["webpack://userscripts/./src/youtube-history-management/youtube-history-management.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         YouTube History Management\r\n// @namespace    http://fuzetsu.com/YHM\r\n// @version      1.1.0\r\n// @description  Select and remove YouTube history items quickly\r\n// @author       fuzetsu\r\n// @match        *://www.youtube.com/*\r\n// @grant        none\r\n// @require      https://greasyfork.org/scripts/5679-wait-for-elements/code/Wait%20For%20Elements.js?version=141779\r\n// @noframes\r\n// @deprecated   true\r\n// ==/UserScript==\r\n\r\n\r\n(function () {\r\n  if (window.top !== window.self)\r\n    return;\r\n\r\n  var deleteQueue = [],\r\n    items = [],\r\n    itemIdx = 0,\r\n    waitID = null,\r\n    EDIT_MODE = false,\r\n    SCRIPT_NAME = 'YouTube History Management',\r\n    SELECT_COLOR = 'orange',\r\n    TITLE_SELECTOR = '.yt-uix-tile-link',\r\n    DESC_SELECTOR = '.yt-lockup-description',\r\n    MENU_SELECTOR = '#browse-items-primary li > ul',\r\n    FEED_SELECTOR = '.yt-lockup-video';\r\n\r\n  var Util = {\r\n    log: function () {\r\n      var args = [].slice.call(arguments);\r\n      args.unshift('%c' + SCRIPT_NAME + ':', 'font-weight: bold;color:navy');\r\n      console.log.apply(console, args);\r\n    },\r\n    q: function (query, context) {\r\n      return (context || document).querySelector(query);\r\n    },\r\n    qq: function (query, context) {\r\n      return [].slice.call((context || document).querySelectorAll(query));\r\n    },\r\n    _cbQueue: [],\r\n    _handleQueue: function () {\r\n      this._cbQueue.shift()();\r\n    },\r\n    queueCallback: function (callback) {\r\n      this._cbQueue.push(callback);\r\n      setTimeout(this._handleQueue.bind(this), 0);\r\n    }\r\n  };\r\n\r\n  function removeItem(item) {\r\n    // find \"remove from watch history\" button within history item\r\n    var btns = Util.qq('button', item);\r\n    btns.some(function (btn) {\r\n      // make sure we have the right button\r\n      if (btn.title.trim() === 'Remove from Watch history') {\r\n        Util.queueCallback(btn.click.bind(btn));\r\n        toggleSelected(item, false, true);\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n\r\n  function toggleUntil(index, item) {\r\n    while (item && !item.dataset.yhmSelected) {\r\n      toggleSelected(item, true);\r\n      item = items[--index];\r\n    }\r\n  }\r\n\r\n  function toggleSelected(item, state, ignore) {\r\n    var title = Util.q(TITLE_SELECTOR, item),\r\n      desc = Util.q(DESC_SELECTOR, item);\r\n    if (state || !item.dataset.yhmSelected) {\r\n      if (!ignore) {\r\n        deleteQueue.push(item);\r\n      }\r\n      item.style.backgroundColor = SELECT_COLOR;\r\n      title && (title.style.backgroundColor = SELECT_COLOR);\r\n      desc && (desc.style.backgroundColor = SELECT_COLOR);\r\n      item.dataset.yhmSelected = 'yes';\r\n    } else {\r\n      if (!ignore) {\r\n        deleteQueue.splice(deleteQueue.indexOf(item), 1);\r\n      }\r\n      item.style.backgroundColor = '';\r\n      title && (title.style.backgroundColor = '');\r\n      desc && (desc.style.backgroundColor = '');\r\n      item.dataset.yhmSelected = '';\r\n    }\r\n  }\r\n\r\n  function makeMenuButton(text, action) {\r\n    var btn = document.createElement('button'),\r\n      liContainer = document.createElement('li');\r\n    btn.className = 'yt-uix-button yt-uix-button-size-default yt-uix-button-default';\r\n    btn.innerHTML = '<span class=\"yt-uix-button-content\">' + text + '</span>';\r\n    btn.addEventListener('click', action, false);\r\n    liContainer.appendChild(btn);\r\n    Util.q(MENU_SELECTOR).appendChild(liContainer);\r\n    return btn;\r\n  }\r\n\r\n  Util.log('Started');\r\n\r\n  waitForUrl(/^http(s)?:\\/\\/www\\.youtube\\.com\\/feed\\/history/, function () {\r\n    var historyUrl = location.href;\r\n    Util.log('Entered history page, waiting for menu area to load');\r\n    waitForElems(MENU_SELECTOR, function () {\r\n      Util.log('Found menu area, creating and inserting buttons');\r\n      // Button that toggles between edit and standard modes\r\n      var btnEditHistory = makeMenuButton('Edit History', function (evt) {\r\n        if (this.textContent === 'Edit History') {\r\n          EDIT_MODE = true;\r\n          this.textContent = 'Stop Editing';\r\n          btnDeleteSelected.parentNode.style.display = '';\r\n        } else {\r\n          EDIT_MODE = false;\r\n          this.textContent = 'Edit History';\r\n          // reset history selection\r\n          while (deleteQueue.length > 0) {\r\n            toggleSelected(deleteQueue.pop(), false, true);\r\n          }\r\n          btnDeleteSelected.parentNode.style.display = 'none';\r\n        }\r\n      });\r\n      // Button that deletes all selected items, only visible while editing\r\n      var btnDeleteSelected = makeMenuButton('Delete Selected', function (evt) {\r\n        var count = deleteQueue.length;\r\n        if (count < 1) return alert('Nothing selected, select at least one history item and try again.');\r\n        EDIT_MODE = false;\r\n        while (deleteQueue.length > 0) {\r\n          removeItem(deleteQueue.pop());\r\n        }\r\n        Util.queueCallback(function () {\r\n          EDIT_MODE = true;\r\n        });\r\n        alert('Deleted ' + count + ' history items.');\r\n      });\r\n      // hide the button pre-emptively\r\n      btnDeleteSelected.parentNode.style.display = 'none';\r\n\r\n      // watch DOM for new history items\r\n      waitID = waitForElems(FEED_SELECTOR, function (item) {\r\n        var index = itemIdx;\r\n        itemIdx += 1;\r\n        items.push(item);\r\n        // bind selecting event for history items\r\n        item.addEventListener('click', function (evt) {\r\n          if (EDIT_MODE) {\r\n            evt.preventDefault();\r\n            evt.stopPropagation();\r\n            if (evt.shiftKey) {\r\n              toggleUntil(index, item);\r\n            } else {\r\n              toggleSelected(item);\r\n            }\r\n            window.getSelection().removeAllRanges();\r\n          }\r\n        }, false);\r\n      });\r\n    }, true);\r\n    waitForUrl(function (url) {\r\n      return url !== historyUrl;\r\n    }, function () {\r\n      clearInterval(waitID);\r\n      EDIT_MODE = false;\r\n      deleteQueue = [];\r\n      Util.log('Leaving history page, cleaning up listeners and references');\r\n    }, true);\r\n  });\r\n})();"],"names":["window","top","self","deleteQueue","items","itemIdx","waitID","EDIT_MODE","SCRIPT_NAME","SELECT_COLOR","TITLE_SELECTOR","DESC_SELECTOR","MENU_SELECTOR","FEED_SELECTOR","Util","log","args","slice","call","arguments","unshift","console","apply","q","query","context","document","querySelector","qq","querySelectorAll","_cbQueue","_handleQueue","this","shift","queueCallback","callback","push","setTimeout","bind","removeItem","item","btns","some","btn","title","trim","click","toggleSelected","toggleUntil","index","dataset","yhmSelected","state","ignore","desc","style","backgroundColor","splice","indexOf","makeMenuButton","text","action","createElement","liContainer","className","innerHTML","addEventListener","appendChild","waitForUrl","historyUrl","location","href","waitForElems","btnEditHistory","evt","textContent","btnDeleteSelected","parentNode","display","length","pop","count","alert","preventDefault","stopPropagation","shiftKey","getSelection","removeAllRanges","url","clearInterval"],"sourceRoot":""}