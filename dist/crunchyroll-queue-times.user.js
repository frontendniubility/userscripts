// ==UserScript==
// @name        Crunchyroll Queue Real Times
// @version     2023.301.5132113
// @description Display countdown until next episode in the Crunchyroll Queue page
// @homepage    https://gitee.com/tsharp/userscripts#readme
// @supportURL  https://gitee.com/tsharp/userscripts/issues
// @match       http://www.crunchyroll.com/home/queue
// @namespace   http://www.fuzetsu.com/CRRT
// @copyright   2014+, fuzetsu
// @deprecated  true
// @downloadURL https://gitee.com/tsharp/userscripts/raw/master/dist/crunchyroll-queue-times.user.js
// @updateURL   https://gitee.com/tsharp/userscripts/raw/master/dist/crunchyroll-queue-times.meta.js
// ==/UserScript==

(()=>{var e,t,n,r=36e5,o=24*r,s=(new Date).getFullYear(),a=function(e,t){return[].slice.call((t||document).querySelectorAll(e))},i=function(e){if("undefined"==typeof GM_getValue){var t=localStorage.getItem(e);return"true"===t||"false"===t?"true"===t:t}return GM_getValue(e)}("CQRT_user_premium");void 0===i&&(i=!0),"function"==typeof GM_registerMenuCommand&&GM_registerMenuCommand("CR Queue countdown: show schedule for "+(i?"PREMIUM":"REGULAR")+" users",(function(){var e,t;e="CQRT_user_premium",t=!i,"undefined"==typeof GM_setValue?localStorage.setItem(e,t):GM_setValue(e,t),window.location.reload()})),e=i?"rgb(255, 251, 223)":"rgb(232, 244, 248)",console.log(e),t=function(t){var n=t.target,i=[];a("td > div > script",n.response).forEach((function(t){var n,r,o;t.previousSibling.previousSibling.style.backgroundColor===e&&i.push((n=t.textContent.trim(),r=JSON.parse(n.slice(n.indexOf("{"),n.lastIndexOf("}")+1)),o=n.slice(n.lastIndexOf("}")+4,n.lastIndexOf('"')),r.date=new Date(o.slice(0,-1)+" "+("a"===o.slice(-1)?"am":"pm")+" "+s),r))}));var u=Date.now();i=i.filter((function(e){return e.date.valueOf()>=u})),a(".queue-wrapper").forEach((function(e){if("http://static.ak.crunchyroll.com/i/coming_soon_beta_wide.jpg"===a(".episode-img img",e)[0].src){var t=a(".series-title",e)[0].textContent,n=function(e,t){var n;return e.some((function(e){if(0===e.name.indexOf(t))return n=e,!0})),n}(i,t);n&&(s=a(".short-desc",e)[0],u=n,l=document.createElement("span"),c=Date.now(),d=u.date.valueOf()-c,f=setInterval((function(){var e=function(e){var t=Math.floor(e/o);e-=t*o;var n=Math.floor(e/r);e-=n*r;var s=Math.floor(e/6e4);e-=6e4*s;var a=Math.floor(e/1e3);return e-=1e3*a,{days:t,hours:n,minutes:s,seconds:a,isDone:function(){return t<=0&&n<=0&&s<=0&&a<=0},toTimeStr:function(){return(this.days>0?this.days+" days ":"")+(this.hours>0?this.hours+" hours ":"")+(this.minutes>0?this.minutes+" minutes ":"")+this.seconds+" seconds"}}}(d);if(e.isDone())return l.innerHTML="<strong>A new episode has been released! Refresh the page to see it.</strong>",clearInterval(f);l.textContent=e.toTimeStr(),d-=Date.now()-c,c=Date.now()}),1e3),s.innerHTML="",s.appendChild(l))}var s,u,l,c,d,f}))},(n=new XMLHttpRequest).open("get","/launchcalendar",!0),n.responseType="document",n.onload=t,n.send()})();
//# sourceMappingURL=crunchyroll-queue-times.user.js.map