// ==UserScript==
// @name        Hummingbird Compatibility Hover
// @version     2023.301.5132113
// @author      fuzetsu
// @description Shows hummingbird user compatibility rating at the bottom right of the screen when a user link is hovered over
// @homepage    https://gitee.com/tsharp/userscripts#readme
// @supportURL  https://gitee.com/tsharp/userscripts/issues
// @match       *://hummingbird.me/*
// @match       *://forums.hummingbird.me/*
// @namespace   http://fuzetsu.com/hch
// @grant       none
// @require     https://greasyfork.org/scripts/5679-wait-for-elements/code/Wait%20For%20Elements.js?1
// @deprecated  true
// @downloadURL https://gitee.com/tsharp/userscripts/raw/master/dist/hummingbird-compatibility-hover.user.js
// @updateURL   https://gitee.com/tsharp/userscripts/raw/master/dist/hummingbird-compatibility-hover.meta.js
// ==/UserScript==

(()=>{var e="Hummingbird Compatibility Hover",t="hb-compat-area",i={},n={log:function(){var t=[].slice.call(arguments);t.unshift("%c"+e+":","font-weight: bold;color: #233c7b;"),console.log.apply(console,t)},q:function(e,t){return(t||document).querySelector(e)},qq:function(e,t){return[].slice.call((t||document).querySelectorAll(e))},getJSON:function(e,t,i){var n=new XMLHttpRequest;n.open("get",e),n.responseType="json",n.onload=function(){t(n.response)},n.onerror=i,n.send()},_style:document.head.appendChild(document.createElement("style")),addStyle:function(e){var t,i,n,o="";for(t in e){for(i in o+=t+"{",n=e[t])o+=i+":"+n[i]+";";o+="}"}this._style.textContent+=o}},o=function(e){return e.match(/\/users\/([a-z0-9_]+)/i)[1]},r={userLinkRegex:/^https?:\/\/(forums\.)?hummingbird\.me\/users\/[^\/]+\/?(\?.*)?$/,styleUI:function(){var e={".hb-visible":{visibility:"visible",opacity:1,transition:"opacity .5s linear"},".hb-hidden":{visibility:"hidden",opacity:0,transition:"visibility 0s .5s, opacity .5s linear"},".hb-compat-percent":{"font-size":"32px","font-weight":"bold",margin:"5px 10px 10px 10px"},".hb-compat-header":{"font-size":"24px",margin:"20px 10px 10px 10px"}},i="#"+t;e[i]={"font-family":'"Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif',position:"fixed",background:"white","text-align":"center","box-shadow":"0px 0px 15px 0px rgba(0,0,0,0.75)","border-top-left-radius":"5px","max-width":"90%",bottom:"0",right:"0","z-index":"10000","line-height":"32px"},e[i+" img"]={margin:"20px 50px 20px 50px"},n.addStyle(e)},getCompatArea:function(){var e=n.q("#"+t);return e||((e=document.createElement("div")).id=t,e.style.display="none",document.body.appendChild(e)),e},getCompatHTML:function(e){return'<h3 class="hb-compat-header">Compatibility is '+e.phrase+'</h3><div class="hb-compat-percent" style="color: '+e.color+'">'+e.percent+"</div>"},showCompat:function(e,t){if(e!==t&&!n.q(".signup-cta")){var o=this,r=this.getCompatArea(),a=i[e+"+"+t];a?r.innerHTML=o.getCompatHTML(a):(r.innerHTML='<img src="https://i.imgur.com/gX1lY9z.gif" />',n.getJSON("https://hbird-cmp-node.herokuapp.com/compatibility/anime?user1="+e+"&user2="+t,(function(n){i[e+"+"+t]=n,r.innerHTML=o.getCompatHTML(n)}))),r.style.display="",setTimeout((function(){r.className="hb-visible"}),0)}},hideCompat:function(){var e=this.getCompatArea();e.className="hb-hidden",setTimeout((function(){e.style.display="none"}),500)},_timeout:null,startHover:function(e){r._timeout=setTimeout((function(){r._timeout=null,r.showCompat(o(n.q(".dropdown-menu > li > a, #current-user > a").href),o(e.target.href))}),750)},stopHover:function(e){clearInterval(r._timeout),r.hideCompat()},start:function(){var e=this;n.log("starting..."),e.styleUI(),waitForElems("a",(function(t){e.userLinkRegex.test(t.href)&&(t.addEventListener("mouseenter",e.startHover),t.addEventListener("mouseleave",e.stopHover),t.addEventListener("click",e.stopHover))}))}};r.start()})();
//# sourceMappingURL=hummingbird-compatibility-hover.user.js.map