{"version":3,"file":"auto-close-youtube-ads.user.js","mappings":"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","sources":["webpack://userscripts/./src/auto-close-youtube-ads/auto-close-youtube-ads.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         Auto Close YouTube Ads\r\n// @namespace    http://fuzetsu.acypa.com\r\n// @version      1.4.1\r\n// @description  Close and/or Mute YouTube ads automatically!\r\n// @author       fuzetsu\r\n// @match        *://*.youtube.com/*\r\n// @exclude      *://*.youtube.com/subscribe_embed?*\r\n// @grant        GM_getValue\r\n// @grant        GM_setValue\r\n// @grant        GM_deleteValue\r\n// @grant        GM_registerMenuCommand\r\n// @require      https://gitcdn.xyz/repo/fuzetsu/userscripts/b38eabf72c20fa3cf7da84ecd2cefe0d4a2116be/wait-for-elements/wait-for-elements.js\r\n// @require      https://gitcdn.xyz/repo/kufii/My-UserScripts/fa4555701cf5a22eae44f06d9848df6966788fa8/libs/gm_config.js\r\n// ==/UserScript==\r\n\r\n/**\r\n * This section of the code holds the css selectors that point different parts of YouTube's\r\n * user interface. If the script ever breaks and you don't want to wait for me to fix it\r\n * chances are that it can be fixed by just updating these selectors here.\r\n */\r\nconst CSS = {\r\n\t// the button used to skip an ad\r\n\tskipButton: \".videoAdUiSkipButton,.ytp-ad-skip-button\",\r\n\t// the area showing the countdown to the skip button showing\r\n\tpreSkipButton: \".videoAdUiPreSkipButton,.ytp-ad-preview-container\",\r\n\t// little x that closes banner ads\r\n\tcloseBannerAd: \".close-padding.contains-svg,a.close-button,.ytp-ad-overlay-close-button\",\r\n\t// button that toggle mute on the video\r\n\tmuteButton: \".ytp-mute-button\",\r\n\t// the slider bar handle that represents the current volume\r\n\tmuteIndicator: \".ytp-volume-slider-handle\",\r\n\t// container for ad on video\r\n\tadArea: \".videoAdUi,.ytp-ad-player-overlay\",\r\n\t// container that shows ad length eg 3:23\r\n\tadLength: \".videoAdUiAttribution,.ytp-ad-duration-remaining\",\r\n\t// container for header ad on the home page\r\n\thomeAdContainer: \"#masthead-ad\",\r\n};\r\n\r\nconst util = {\r\n\tlog: (...args) => console.log(`%c${SCRIPT_NAME}:`, \"font-weight: bold;color: purple;\", ...args),\r\n\tclearTicks: (ticks) => {\r\n\t\tticks.forEach((tick) => (!tick ? null : typeof tick === \"number\" ? clearInterval(tick) : tick.stop()));\r\n\t\tticks.length = 0;\r\n\t},\r\n\tkeepTrying: (wait, action) => {\r\n\t\tconst tick = setInterval(() => action() && clearInterval(tick), wait);\r\n\t\treturn tick;\r\n\t},\r\n\tstoreGet: (key) => {\r\n\t\tif (typeof GM_getValue === \"undefined\") {\r\n\t\t\tconst value = localStorage.getItem(key);\r\n\t\t\treturn value === \"true\" ? true : value === \"false\" ? false : value;\r\n\t\t}\r\n\t\treturn GM_getValue(key);\r\n\t},\r\n\tstoreSet: (key, value) => (typeof GM_setValue === \"undefined\" ? localStorage.setItem(key, value) : GM_setValue(key, value)),\r\n\tstoreDel: (key) => (typeof GM_deleteValue === \"undefined\" ? localStorage.removeItem(key) : GM_deleteValue(key)),\r\n\tq: (query, context) => (context || document).querySelector(query),\r\n\tqq: (query, context) => Array.from((context || document).querySelectorAll(query)),\r\n\tget: (obj, str) => util.getPath(obj, str.split(\".\").reverse()),\r\n\tgetPath: (obj, path) => (obj == null ? null : path.length > 0 ? util.getPath(obj[path.pop()], path) : obj),\r\n};\r\n\r\nconst SCRIPT_NAME = \"Auto Close YouTube Ads\";\r\nconst SHORT_AD_MSG_LENGTH = 12000;\r\nconst TICKS = [];\r\nlet DONT_SKIP = false;\r\n\r\nconst config = GM_config([\r\n\t{\r\n\t\tkey: \"muteAd\",\r\n\t\tlabel: \"Mute ads?\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: true,\r\n\t},\r\n\t{\r\n\t\tkey: \"hideAd\",\r\n\t\tlabel: \"Hide video ads?\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: false,\r\n\t},\r\n\t{\r\n\t\tkey: \"secWaitBanner\",\r\n\t\tlabel: \"Banner ad close delay (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 3,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"secWaitVideo\",\r\n\t\tlabel: \"Video ad skip delay (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 3,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"minAdLengthForSkip\",\r\n\t\tlabel: \"Dont skip video shorter than this (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 0,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"muteEvenIfNotSkipping\",\r\n\t\tlabel: \"Mute video even if not skipping\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: true,\r\n\t},\r\n\t{\r\n\t\tkey: \"debug\",\r\n\t\tlabel: \"Show extra debug information.\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: false,\r\n\t},\r\n\t{\r\n\t\tkey: \"version\",\r\n\t\ttype: \"hidden\",\r\n\t\tdefault: 1,\r\n\t},\r\n]);\r\n\r\nconst configVersion = 2;\r\nlet conf = config.load();\r\n\r\nconfig.onsave = (cfg) => (conf = cfg);\r\n\r\n// config upgrade procedure\r\nfunction upgradeConfig() {\r\n\tlet lastVersion;\r\n\twhile (conf.version < configVersion && lastVersion !== conf.version) {\r\n\t\tutil.log(\"upgrading config version, current = \", conf.version, \", target = \", configVersion);\r\n\t\tlastVersion = conf.version;\r\n\t\tswitch (conf.version) {\r\n\t\t\tcase 1: {\r\n\t\t\t\tconst oldConf = {\r\n\t\t\t\t\tmuteAd: util.storeGet(\"MUTE_AD\"),\r\n\t\t\t\t\thideAd: util.storeGet(\"HIDE_AD\"),\r\n\t\t\t\t\tsecWait: util.storeGet(\"SEC_WAIT\"),\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (oldConf.muteAd != null) conf.muteAd = !!oldConf.muteAd;\r\n\t\t\t\tif (oldConf.hideAd != null) conf.hideAd = !!oldConf.hideAd;\r\n\t\t\t\tif (oldConf.secWait != null && !isNaN(oldConf.secWait)) conf.secWaitBanner = conf.secWaitVideo = parseInt(oldConf.secWait);\r\n\r\n\t\t\t\tconf.version = 2;\r\n\r\n\t\t\t\tconfig.save(conf);\r\n\t\t\t\t[\"SEC_WAIT\", \"HIDE_AD\", \"MUTE_AD\"].forEach(util.storeDel);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nupgradeConfig();\r\n\r\nfunction createMessageElement() {\r\n\tconst elem = document.createElement(\"div\");\r\n\telem.setAttribute(\"style\", \"border: 1px solid white;border-right: none;background: rgb(0,0,0,0.75);color:white;position: absolute;right: 0;z-index: 1000;top: 10px;padding: 10px;padding-right: 20px;cursor: pointer;pointer-events: all;\");\r\n\treturn elem;\r\n}\r\nfunction showMessage(container, text, ms) {\r\n\tconst message = createMessageElement();\r\n\tmessage.textContent = text;\r\n\tcontainer.appendChild(message);\r\n\tutil.log(`showing message [${ms}ms]: ${text}`);\r\n\tsetTimeout(() => message.remove(), ms);\r\n}\r\n\r\nfunction setupCancelDiv(ad) {\r\n\tconst skipArea = util.q(CSS.preSkipButton, ad);\r\n\tconst skipText = skipArea && skipArea.textContent.trim().replace(/\\s+/g, \" \");\r\n\tif (skipText && ![\"will begin\", \"will play\"].some((snip) => skipText.includes(snip))) {\r\n\t\tconst cancelClass = \"acya-cancel-skip\";\r\n\t\tlet cancelDiv = util.q(\".\" + cancelClass);\r\n\t\tif (cancelDiv) cancelDiv.remove();\r\n\t\tcancelDiv = createMessageElement();\r\n\t\tcancelDiv.className = cancelClass;\r\n\t\tcancelDiv.textContent = (conf.muteAd ? \"Un-mute & \" : \"\") + \"Cancel Auto Skip\";\r\n\t\tcancelDiv.onclick = () => {\r\n\t\t\tutil.log(\"cancel clicked\");\r\n\t\t\tDONT_SKIP = true;\r\n\t\t\tcancelDiv.remove();\r\n\t\t\tconst muteButton = getMuteButton();\r\n\t\t\tconst muteIndicator = getMuteIndicator();\r\n\t\t\tif (conf.muteAd && muteButton && muteIndicator && isMuted(muteIndicator)) muteButton.click();\r\n\t\t};\r\n\t\tad.appendChild(cancelDiv);\r\n\t} else {\r\n\t\tutil.log(\"skip button area wasn't there for some reason.. couldn't place cancel button.\");\r\n\t}\r\n}\r\n\r\nfunction parseTime(str) {\r\n\tconst [minutes, seconds] = str\r\n\t\t.split(\" \")\r\n\t\t.pop()\r\n\t\t.split(\":\")\r\n\t\t.map((num) => parseInt(num));\r\n\tutil.log(str, minutes, seconds);\r\n\treturn minutes * 60 + seconds || 0;\r\n}\r\n\r\nconst getMuteButton = () => util.q(CSS.muteButton);\r\nconst getMuteIndicator = () => util.q(CSS.muteIndicator);\r\nconst isMuted = (m) => m.style.left === \"0px\";\r\n\r\nfunction getAdLength(ad) {\r\n\tif (!ad) return 0;\r\n\tconst time = ad.querySelector(CSS.adLength);\r\n\treturn time ? parseTime(time.textContent) : 0;\r\n}\r\n\r\nfunction waitForAds() {\r\n\tDONT_SKIP = false;\r\n\tTICKS.push(\r\n\t\twaitForElems({\r\n\t\t\tsel: CSS.skipButton,\r\n\t\t\tonmatch: (btn) => {\r\n\t\t\t\tutil.log(\"found skip button\");\r\n\t\t\t\tutil.keepTrying(500, () => {\r\n\t\t\t\t\tif (!btn) return true;\r\n\t\t\t\t\t// if not visible\r\n\t\t\t\t\tif (btn.offsetParent === null) return;\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tif (DONT_SKIP) {\r\n\t\t\t\t\t\t\tutil.log(\"not skipping...\");\r\n\t\t\t\t\t\t\tDONT_SKIP = false;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tutil.log(\"clicking skip button\");\r\n\t\t\t\t\t\tbtn.click();\r\n\t\t\t\t\t}, conf.secWaitVideo * 1000);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t}),\r\n\t\twaitAndClick(CSS.closeBannerAd, conf.secWaitBanner * 1000),\r\n\t\twaitForElems({\r\n\t\t\tsel: CSS.adArea,\r\n\t\t\tonmatch: (ad) => {\r\n\t\t\t\t// reset don't skip\r\n\t\t\t\tDONT_SKIP = false;\r\n\t\t\t\tconst adLength = getAdLength(ad);\r\n\t\t\t\tconst isShort = adLength < conf.minAdLengthForSkip;\r\n\t\t\t\tconst debug = () => (conf.debug ? `[DEBUG adLength = ${adLength}, minAdLengthForSkip = ${conf.minAdLengthForSkip}]` : \"\");\r\n\t\t\t\tif (isShort && !conf.muteEvenIfNotSkipping) {\r\n\t\t\t\t\tDONT_SKIP = true;\r\n\t\t\t\t\treturn showMessage(ad, `Shot AD detected, will not skip or mute. ${debug()}`, SHORT_AD_MSG_LENGTH);\r\n\t\t\t\t}\r\n\t\t\t\tif (conf.hideAd) {\r\n\t\t\t\t\tad.style.zIndex = 10;\r\n\t\t\t\t\tad.style.background = \"black\";\r\n\t\t\t\t}\r\n\t\t\t\t// show option to cancel automatic skip\r\n\t\t\t\tif (!isShort) setupCancelDiv(ad);\r\n\t\t\t\tif (!conf.muteAd) return;\r\n\t\t\t\tconst muteButton = getMuteButton();\r\n\t\t\t\tconst muteIndicator = getMuteIndicator();\r\n\t\t\t\tif (!muteIndicator) return util.log(\"unable to determine mute state, skipping mute\");\r\n\t\t\t\tmuteButton.click();\r\n\t\t\t\tutil.log(\"Video ad detected, muting audio\");\r\n\t\t\t\t// wait for the ad to disappear before unmuting\r\n\t\t\t\tutil.keepTrying(250, () => {\r\n\t\t\t\t\tif (!util.q(CSS.adArea)) {\r\n\t\t\t\t\t\tif (isMuted(muteIndicator)) {\r\n\t\t\t\t\t\t\tmuteButton.click();\r\n\t\t\t\t\t\t\tutil.log(\"Video ad ended, unmuting audio\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tutil.log(\"Video ad ended, audio already unmuted\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (isShort) {\r\n\t\t\t\t\tDONT_SKIP = true;\r\n\t\t\t\t\treturn showMessage(ad, `Short AD detected, will not skip but will mute. ${debug()}`, SHORT_AD_MSG_LENGTH);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t}),\r\n\t);\r\n}\r\n\r\nconst waitAndClick = (sel, ms, cb) =>\r\n\twaitForElems({\r\n\t\tsel: sel,\r\n\t\tonmatch: (btn) => {\r\n\t\t\tutil.log(\"Found ad, closing in\", ms, \"ms\");\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tbtn.click();\r\n\t\t\t\tif (cb) cb(btn);\r\n\t\t\t}, ms);\r\n\t\t},\r\n\t});\r\n\r\nutil.log(\"Started\");\r\n\r\nif (window.self === window.top) {\r\n\tlet videoUrl;\r\n\t// close home ad whenever encountered\r\n\twaitForElems({ sel: CSS.homeAdContainer, onmatch: (ad) => ad.remove() });\r\n\t// wait for video page\r\n\twaitForUrl(/^https:\\/\\/www\\.youtube\\.com\\/watch\\?.*v=.+/, () => {\r\n\t\tif (videoUrl && location.href !== videoUrl) {\r\n\t\t\tutil.log(\"Changed video, removing old wait\");\r\n\t\t\tutil.clearTicks(TICKS);\r\n\t\t}\r\n\t\tvideoUrl = location.href;\r\n\t\tutil.log(\"Entered video, waiting for ads\");\r\n\t\twaitForAds();\r\n\t\tTICKS.push(\r\n\t\t\twaitForUrl(\r\n\t\t\t\t(url) => url !== videoUrl,\r\n\t\t\t\t() => {\r\n\t\t\t\t\tvideoUrl = null;\r\n\t\t\t\t\tutil.clearTicks(TICKS);\r\n\t\t\t\t\tutil.log(\"Left video, stopped waiting for ads\");\r\n\t\t\t\t},\r\n\t\t\t\ttrue,\r\n\t\t\t),\r\n\t\t);\r\n\t});\r\n} else {\r\n\tif (/^https:\\/\\/www\\.youtube\\.com\\/embed\\//.test(location.href)) {\r\n\t\tutil.log(\"Found embedded video, waiting for ads\");\r\n\t\twaitForAds();\r\n\t}\r\n}\r\n\r\nGM_registerMenuCommand(\"Auto Close Youtube Ads - Manage Settings\", config.setup);\r\n"],"names":["CSS","skipButton","preSkipButton","closeBannerAd","muteButton","muteIndicator","adArea","adLength","homeAdContainer","util","log","_console","_len","arguments","length","args","Array","_key","console","apply","concat","SCRIPT_NAME","clearTicks","ticks","forEach","tick","clearInterval","stop","keepTrying","wait","action","setInterval","storeGet","key","GM_getValue","value","localStorage","getItem","storeSet","GM_setValue","setItem","storeDel","GM_deleteValue","removeItem","q","query","context","document","querySelector","qq","from","querySelectorAll","get","obj","str","getPath","split","reverse","path","pop","SHORT_AD_MSG_LENGTH","TICKS","DONT_SKIP","config","GM_config","label","type","default","min","configVersion","conf","load","onsave","cfg","upgradeConfig","lastVersion","version","oldConf","muteAd","hideAd","secWait","isNaN","secWaitBanner","secWaitVideo","parseInt","save","createMessageElement","elem","createElement","setAttribute","showMessage","container","text","ms","message","textContent","appendChild","setTimeout","remove","setupCancelDiv","ad","skipArea","skipText","trim","replace","some","snip","includes","cancelClass","cancelDiv","className","onclick","getMuteButton","getMuteIndicator","isMuted","click","parseTime","_str$split$pop$split$","map","num","_str$split$pop$split$2","_slicedToArray","minutes","seconds","m","style","left","getAdLength","time","waitForAds","push","waitForElems","sel","onmatch","btn","offsetParent","waitAndClick","isShort","minAdLengthForSkip","debug","muteEvenIfNotSkipping","zIndex","background","cb","window","self","top","videoUrl","waitForUrl","location","href","url","test","GM_registerMenuCommand","setup"],"sourceRoot":""}