{"version":3,"file":"auto-close-youtube-ads.user.js","mappings":"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","sources":["webpack://userscripts/./src/auto-close-youtube-ads/auto-close-youtube-ads.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         Auto Close YouTube Ads\r\n// @namespace    http://fuzetsu.acypa.com\r\n// @version      1.4.1\r\n// @description  Close and/or Mute YouTube ads automatically!\r\n// @author       fuzetsu\r\n// @match        *://*.youtube.com/*\r\n// @exclude      *://*.youtube.com/subscribe_embed?*\r\n// @grant        GM_getValue\r\n// @grant        GM_setValue\r\n// @grant        GM_deleteValue\r\n// @grant        GM_registerMenuCommand\r\n// @require      https://gitcdn.xyz/repo/fuzetsu/userscripts/b38eabf72c20fa3cf7da84ecd2cefe0d4a2116be/wait-for-elements/wait-for-elements.js\r\n// @require      https://gitcdn.xyz/repo/kufii/My-UserScripts/fa4555701cf5a22eae44f06d9848df6966788fa8/libs/gm_config.js\r\n// ==/UserScript==\r\n\r\n/**\r\n * This section of the code holds the css selectors that point different parts of YouTube's\r\n * user interface. If the script ever breaks and you don't want to wait for me to fix it\r\n * chances are that it can be fixed by just updating these selectors here.\r\n */\r\nconst CSS = {\r\n\t// the button used to skip an ad\r\n\tskipButton: \".videoAdUiSkipButton,.ytp-ad-skip-button\",\r\n\t// the area showing the countdown to the skip button showing\r\n\tpreSkipButton: \".videoAdUiPreSkipButton,.ytp-ad-preview-container\",\r\n\t// little x that closes banner ads\r\n\tcloseBannerAd: \".close-padding.contains-svg,a.close-button,.ytp-ad-overlay-close-button\",\r\n\t// button that toggle mute on the video\r\n\tmuteButton: \".ytp-mute-button\",\r\n\t// the slider bar handle that represents the current volume\r\n\tmuteIndicator: \".ytp-volume-slider-handle\",\r\n\t// container for ad on video\r\n\tadArea: \".videoAdUi,.ytp-ad-player-overlay\",\r\n\t// container that shows ad length eg 3:23\r\n\tadLength: \".videoAdUiAttribution,.ytp-ad-duration-remaining\",\r\n\t// container for header ad on the home page\r\n\thomeAdContainer: \"#masthead-ad\",\r\n};\r\n\r\nconst util = {\r\n\tlog: (...args) => console.log(`%c${SCRIPT_NAME}:`, \"font-weight: bold;color: purple;\", ...args),\r\n\tclearTicks: (ticks) => {\r\n\t\tticks.forEach((tick) => (!tick ? null : typeof tick === \"number\" ? clearInterval(tick) : tick.stop()));\r\n\t\tticks.length = 0;\r\n\t},\r\n\tkeepTrying: (wait, action) => {\r\n\t\tconst tick = setInterval(() => action() && clearInterval(tick), wait);\r\n\t\treturn tick;\r\n\t},\r\n\tstoreGet: (key) => {\r\n\t\tif (typeof GM_getValue === \"undefined\") {\r\n\t\t\tconst value = localStorage.getItem(key);\r\n\t\t\treturn value === \"true\" ? true : value === \"false\" ? false : value;\r\n\t\t}\r\n\t\treturn GM_getValue(key);\r\n\t},\r\n\tstoreSet: (key, value) => (typeof GM_setValue === \"undefined\" ? localStorage.setItem(key, value) : GM_setValue(key, value)),\r\n\tstoreDel: (key) => (typeof GM_deleteValue === \"undefined\" ? localStorage.removeItem(key) : GM_deleteValue(key)),\r\n\tq: (query, context) => (context || document).querySelector(query),\r\n\tqq: (query, context) => Array.from((context || document).querySelectorAll(query)),\r\n\tget: (obj, str) => util.getPath(obj, str.split(\".\").reverse()),\r\n\tgetPath: (obj, path) => (obj == null ? null : path.length > 0 ? util.getPath(obj[path.pop()], path) : obj),\r\n};\r\n\r\nconst SCRIPT_NAME = \"Auto Close YouTube Ads\";\r\nconst SHORT_AD_MSG_LENGTH = 12000;\r\nconst TICKS = [];\r\nlet DONT_SKIP = false;\r\n\r\nconst config = GM_config([\r\n\t{\r\n\t\tkey: \"muteAd\",\r\n\t\tlabel: \"Mute ads?\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: true,\r\n\t},\r\n\t{\r\n\t\tkey: \"hideAd\",\r\n\t\tlabel: \"Hide video ads?\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: false,\r\n\t},\r\n\t{\r\n\t\tkey: \"secWaitBanner\",\r\n\t\tlabel: \"Banner ad close delay (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 3,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"secWaitVideo\",\r\n\t\tlabel: \"Video ad skip delay (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 3,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"minAdLengthForSkip\",\r\n\t\tlabel: \"Dont skip video shorter than this (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 0,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"muteEvenIfNotSkipping\",\r\n\t\tlabel: \"Mute video even if not skipping\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: true,\r\n\t},\r\n\t{\r\n\t\tkey: \"debug\",\r\n\t\tlabel: \"Show extra debug information.\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: false,\r\n\t},\r\n\t{\r\n\t\tkey: \"version\",\r\n\t\ttype: \"hidden\",\r\n\t\tdefault: 1,\r\n\t},\r\n]);\r\n\r\nconst configVersion = 2;\r\nlet conf = config.load();\r\n\r\nconfig.onsave = (cfg) => (conf = cfg);\r\n\r\n// config upgrade procedure\r\nfunction upgradeConfig() {\r\n\tlet lastVersion;\r\n\twhile (conf.version < configVersion && lastVersion !== conf.version) {\r\n\t\tutil.log(\"upgrading config version, current = \", conf.version, \", target = \", configVersion);\r\n\t\tlastVersion = conf.version;\r\n\t\tswitch (conf.version) {\r\n\t\t\tcase 1: {\r\n\t\t\t\tconst oldConf = {\r\n\t\t\t\t\tmuteAd: util.storeGet(\"MUTE_AD\"),\r\n\t\t\t\t\thideAd: util.storeGet(\"HIDE_AD\"),\r\n\t\t\t\t\tsecWait: util.storeGet(\"SEC_WAIT\"),\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (oldConf.muteAd != null) conf.muteAd = !!oldConf.muteAd;\r\n\t\t\t\tif (oldConf.hideAd != null) conf.hideAd = !!oldConf.hideAd;\r\n\t\t\t\tif (oldConf.secWait != null && !isNaN(oldConf.secWait)) conf.secWaitBanner = conf.secWaitVideo = parseInt(oldConf.secWait);\r\n\r\n\t\t\t\tconf.version = 2;\r\n\r\n\t\t\t\tconfig.save(conf);\r\n\t\t\t\t[\"SEC_WAIT\", \"HIDE_AD\", \"MUTE_AD\"].forEach(util.storeDel);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nupgradeConfig();\r\n\r\nfunction createMessageElement() {\r\n\tconst elem = document.createElement(\"div\");\r\n\telem.setAttribute(\"style\", \"border: 1px solid white;border-right: none;background: rgb(0,0,0,0.75);color:white;position: absolute;right: 0;z-index: 1000;top: 10px;padding: 10px;padding-right: 20px;cursor: pointer;pointer-events: all;\");\r\n\treturn elem;\r\n}\r\nfunction showMessage(container, text, ms) {\r\n\tconst message = createMessageElement();\r\n\tmessage.textContent = text;\r\n\tcontainer.appendChild(message);\r\n\tutil.log(`showing message [${ms}ms]: ${text}`);\r\n\tsetTimeout(() => message.remove(), ms);\r\n}\r\n\r\nfunction setupCancelDiv(ad) {\r\n\tconst skipArea = util.q(CSS.preSkipButton, ad);\r\n\tconst skipText = skipArea && skipArea.textContent.trim().replace(/\\s+/g, \" \");\r\n\tif (skipText && ![\"will begin\", \"will play\"].some((snip) => skipText.includes(snip))) {\r\n\t\tconst cancelClass = \"acya-cancel-skip\";\r\n\t\tlet cancelDiv = util.q(\".\" + cancelClass);\r\n\t\tif (cancelDiv) cancelDiv.remove();\r\n\t\tcancelDiv = createMessageElement();\r\n\t\tcancelDiv.className = cancelClass;\r\n\t\tcancelDiv.textContent = (conf.muteAd ? \"Un-mute & \" : \"\") + \"Cancel Auto Skip\";\r\n\t\tcancelDiv.onclick = () => {\r\n\t\t\tutil.log(\"cancel clicked\");\r\n\t\t\tDONT_SKIP = true;\r\n\t\t\tcancelDiv.remove();\r\n\t\t\tconst muteButton = getMuteButton();\r\n\t\t\tconst muteIndicator = getMuteIndicator();\r\n\t\t\tif (conf.muteAd && muteButton && muteIndicator && isMuted(muteIndicator)) muteButton.click();\r\n\t\t};\r\n\t\tad.appendChild(cancelDiv);\r\n\t} else {\r\n\t\tutil.log(\"skip button area wasn't there for some reason.. couldn't place cancel button.\");\r\n\t}\r\n}\r\n\r\nfunction parseTime(str) {\r\n\tconst [minutes, seconds] = str\r\n\t\t.split(\" \")\r\n\t\t.pop()\r\n\t\t.split(\":\")\r\n\t\t.map((num) => parseInt(num));\r\n\tutil.log(str, minutes, seconds);\r\n\treturn minutes * 60 + seconds || 0;\r\n}\r\n\r\nconst getMuteButton = () => util.q(CSS.muteButton);\r\nconst getMuteIndicator = () => util.q(CSS.muteIndicator);\r\nconst isMuted = (m) => m.style.left === \"0px\";\r\n\r\nfunction getAdLength(ad) {\r\n\tif (!ad) return 0;\r\n\tconst time = ad.querySelector(CSS.adLength);\r\n\treturn time ? parseTime(time.textContent) : 0;\r\n}\r\n\r\nfunction waitForAds() {\r\n\tDONT_SKIP = false;\r\n\tTICKS.push(\r\n\t\twaitForElems({\r\n\t\t\tsel: CSS.skipButton,\r\n\t\t\tonmatch: (btn) => {\r\n\t\t\t\tutil.log(\"found skip button\");\r\n\t\t\t\tutil.keepTrying(500, () => {\r\n\t\t\t\t\tif (!btn) return true;\r\n\t\t\t\t\t// if not visible\r\n\t\t\t\t\tif (btn.offsetParent === null) return;\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tif (DONT_SKIP) {\r\n\t\t\t\t\t\t\tutil.log(\"not skipping...\");\r\n\t\t\t\t\t\t\tDONT_SKIP = false;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tutil.log(\"clicking skip button\");\r\n\t\t\t\t\t\tbtn.click();\r\n\t\t\t\t\t}, conf.secWaitVideo * 1000);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t}),\r\n\t\twaitAndClick(CSS.closeBannerAd, conf.secWaitBanner * 1000),\r\n\t\twaitForElems({\r\n\t\t\tsel: CSS.adArea,\r\n\t\t\tonmatch: (ad) => {\r\n\t\t\t\t// reset don't skip\r\n\t\t\t\tDONT_SKIP = false;\r\n\t\t\t\tconst adLength = getAdLength(ad);\r\n\t\t\t\tconst isShort = adLength < conf.minAdLengthForSkip;\r\n\t\t\t\tconst debug = () => (conf.debug ? `[DEBUG adLength = ${adLength}, minAdLengthForSkip = ${conf.minAdLengthForSkip}]` : \"\");\r\n\t\t\t\tif (isShort && !conf.muteEvenIfNotSkipping) {\r\n\t\t\t\t\tDONT_SKIP = true;\r\n\t\t\t\t\treturn showMessage(ad, `Shot AD detected, will not skip or mute. ${debug()}`, SHORT_AD_MSG_LENGTH);\r\n\t\t\t\t}\r\n\t\t\t\tif (conf.hideAd) {\r\n\t\t\t\t\tad.style.zIndex = 10;\r\n\t\t\t\t\tad.style.background = \"black\";\r\n\t\t\t\t}\r\n\t\t\t\t// show option to cancel automatic skip\r\n\t\t\t\tif (!isShort) setupCancelDiv(ad);\r\n\t\t\t\tif (!conf.muteAd) return;\r\n\t\t\t\tconst muteButton = getMuteButton();\r\n\t\t\t\tconst muteIndicator = getMuteIndicator();\r\n\t\t\t\tif (!muteIndicator) return util.log(\"unable to determine mute state, skipping mute\");\r\n\t\t\t\tmuteButton.click();\r\n\t\t\t\tutil.log(\"Video ad detected, muting audio\");\r\n\t\t\t\t// wait for the ad to disappear before unmuting\r\n\t\t\t\tutil.keepTrying(250, () => {\r\n\t\t\t\t\tif (!util.q(CSS.adArea)) {\r\n\t\t\t\t\t\tif (isMuted(muteIndicator)) {\r\n\t\t\t\t\t\t\tmuteButton.click();\r\n\t\t\t\t\t\t\tutil.log(\"Video ad ended, unmuting audio\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tutil.log(\"Video ad ended, audio already unmuted\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (isShort) {\r\n\t\t\t\t\tDONT_SKIP = true;\r\n\t\t\t\t\treturn showMessage(ad, `Short AD detected, will not skip but will mute. ${debug()}`, SHORT_AD_MSG_LENGTH);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t}),\r\n\t);\r\n}\r\n\r\nconst waitAndClick = (sel, ms, cb) =>\r\n\twaitForElems({\r\n\t\tsel: sel,\r\n\t\tonmatch: (btn) => {\r\n\t\t\tutil.log(\"Found ad, closing in\", ms, \"ms\");\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tbtn.click();\r\n\t\t\t\tif (cb) cb(btn);\r\n\t\t\t}, ms);\r\n\t\t},\r\n\t});\r\n\r\nutil.log(\"Started\");\r\n\r\nif (window.self === window.top) {\r\n\tlet videoUrl;\r\n\t// close home ad whenever encountered\r\n\twaitForElems({ sel: CSS.homeAdContainer, onmatch: (ad) => ad.remove() });\r\n\t// wait for video page\r\n\twaitForUrl(/^https:\\/\\/www\\.youtube\\.com\\/watch\\?.*v=.+/, () => {\r\n\t\tif (videoUrl && location.href !== videoUrl) {\r\n\t\t\tutil.log(\"Changed video, removing old wait\");\r\n\t\t\tutil.clearTicks(TICKS);\r\n\t\t}\r\n\t\tvideoUrl = location.href;\r\n\t\tutil.log(\"Entered video, waiting for ads\");\r\n\t\twaitForAds();\r\n\t\tTICKS.push(\r\n\t\t\twaitForUrl(\r\n\t\t\t\t(url) => url !== videoUrl,\r\n\t\t\t\t() => {\r\n\t\t\t\t\tvideoUrl = null;\r\n\t\t\t\t\tutil.clearTicks(TICKS);\r\n\t\t\t\t\tutil.log(\"Left video, stopped waiting for ads\");\r\n\t\t\t\t},\r\n\t\t\t\ttrue,\r\n\t\t\t),\r\n\t\t);\r\n\t});\r\n} else {\r\n\tif (/^https:\\/\\/www\\.youtube\\.com\\/embed\\//.test(location.href)) {\r\n\t\tutil.log(\"Found embedded video, waiting for ads\");\r\n\t\twaitForAds();\r\n\t}\r\n}\r\n\r\nGM_registerMenuCommand(\"Auto Close Youtube Ads - Manage Settings\", config.setup);\r\n"],"names":["CSS","util","log","_console","_len","arguments","length","args","Array","_key","console","apply","concat","SCRIPT_NAME","clearTicks","ticks","forEach","tick","clearInterval","stop","keepTrying","wait","action","setInterval","storeGet","key","GM_getValue","value","localStorage","getItem","storeSet","GM_setValue","setItem","storeDel","GM_deleteValue","removeItem","q","query","context","document","querySelector","qq","from","querySelectorAll","get","obj","str","getPath","split","reverse","path","pop","TICKS","DONT_SKIP","config","GM_config","label","type","default","min","conf","load","createMessageElement","elem","createElement","setAttribute","showMessage","container","text","ms","message","textContent","appendChild","setTimeout","remove","onsave","cfg","lastVersion","version","oldConf","muteAd","hideAd","secWait","isNaN","secWaitBanner","secWaitVideo","parseInt","save","upgradeConfig","getMuteButton","getMuteIndicator","isMuted","m","style","left","getAdLength","ad","_str$split$pop$split$2","minutes","seconds","time","map","num","waitForAds","push","waitForElems","sel","onmatch","btn","offsetParent","click","waitAndClick","adLength","isShort","minAdLengthForSkip","debug","muteEvenIfNotSkipping","zIndex","background","skipArea","skipText","trim","replace","some","snip","includes","cancelClass","cancelDiv","className","onclick","muteButton","muteIndicator","setupCancelDiv","videoUrl","cb","window","self","top","waitForUrl","location","href","url","test","GM_registerMenuCommand","setup"],"sourceRoot":""}