{"version":3,"file":"auto-close-youtube-ads.user.js","mappings":"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","sources":["webpack://userscripts/./src/auto-close-youtube-ads/auto-close-youtube-ads.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         Auto Close YouTube Ads\r\n// @namespace    http://fuzetsu.acypa.com\r\n// @version      1.4.1\r\n// @description  Close and/or Mute YouTube ads automatically!\r\n// @author       fuzetsu\r\n// @match        *://*.youtube.com/*\r\n// @exclude      *://*.youtube.com/subscribe_embed?*\r\n// @grant        GM_getValue\r\n// @grant        GM_setValue\r\n// @grant        GM_deleteValue\r\n// @grant        GM_registerMenuCommand\r\n// @require      https://gitcdn.xyz/repo/fuzetsu/userscripts/b38eabf72c20fa3cf7da84ecd2cefe0d4a2116be/wait-for-elements/wait-for-elements.js\r\n// @require      https://gitcdn.xyz/repo/kufii/My-UserScripts/fa4555701cf5a22eae44f06d9848df6966788fa8/libs/gm_config.js\r\n// ==/UserScript==\r\n\r\n/**\r\n * This section of the code holds the css selectors that point different parts of YouTube's\r\n * user interface. If the script ever breaks and you don't want to wait for me to fix it\r\n * chances are that it can be fixed by just updating these selectors here.\r\n */\r\nconst CSS = {\r\n\t// the button used to skip an ad\r\n\tskipButton: \".videoAdUiSkipButton,.ytp-ad-skip-button\",\r\n\t// the area showing the countdown to the skip button showing\r\n\tpreSkipButton: \".videoAdUiPreSkipButton,.ytp-ad-preview-container\",\r\n\t// little x that closes banner ads\r\n\tcloseBannerAd: \".close-padding.contains-svg,a.close-button,.ytp-ad-overlay-close-button\",\r\n\t// button that toggle mute on the video\r\n\tmuteButton: \".ytp-mute-button\",\r\n\t// the slider bar handle that represents the current volume\r\n\tmuteIndicator: \".ytp-volume-slider-handle\",\r\n\t// container for ad on video\r\n\tadArea: \".videoAdUi,.ytp-ad-player-overlay\",\r\n\t// container that shows ad length eg 3:23\r\n\tadLength: \".videoAdUiAttribution,.ytp-ad-duration-remaining\",\r\n\t// container for header ad on the home page\r\n\thomeAdContainer: \"#masthead-ad\",\r\n};\r\n\r\nconst util = {\r\n\tlog: (...args) => console.log(`%c${SCRIPT_NAME}:`, \"font-weight: bold;color: purple;\", ...args),\r\n\tclearTicks: (ticks) => {\r\n\t\tticks.forEach((tick) => (!tick ? null : typeof tick === \"number\" ? clearInterval(tick) : tick.stop()));\r\n\t\tticks.length = 0;\r\n\t},\r\n\tkeepTrying: (wait, action) => {\r\n\t\tconst tick = setInterval(() => action() && clearInterval(tick), wait);\r\n\t\treturn tick;\r\n\t},\r\n\tstoreGet: (key) => {\r\n\t\tif (typeof GM_getValue === \"undefined\") {\r\n\t\t\tconst value = localStorage.getItem(key);\r\n\t\t\treturn value === \"true\" ? true : value === \"false\" ? false : value;\r\n\t\t}\r\n\t\treturn GM_getValue(key);\r\n\t},\r\n\tstoreSet: (key, value) => (typeof GM_setValue === \"undefined\" ? localStorage.setItem(key, value) : GM_setValue(key, value)),\r\n\tstoreDel: (key) => (typeof GM_deleteValue === \"undefined\" ? localStorage.removeItem(key) : GM_deleteValue(key)),\r\n\tq: (query, context) => (context || document).querySelector(query),\r\n\tqq: (query, context) => Array.from((context || document).querySelectorAll(query)),\r\n\tget: (obj, str) => util.getPath(obj, str.split(\".\").reverse()),\r\n\tgetPath: (obj, path) => (obj == null ? null : path.length > 0 ? util.getPath(obj[path.pop()], path) : obj),\r\n};\r\n\r\nconst SCRIPT_NAME = \"Auto Close YouTube Ads\";\r\nconst SHORT_AD_MSG_LENGTH = 12000;\r\nconst TICKS = [];\r\nlet DONT_SKIP = false;\r\n\r\nconst config = GM_config([\r\n\t{\r\n\t\tkey: \"muteAd\",\r\n\t\tlabel: \"Mute ads?\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: true,\r\n\t},\r\n\t{\r\n\t\tkey: \"hideAd\",\r\n\t\tlabel: \"Hide video ads?\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: false,\r\n\t},\r\n\t{\r\n\t\tkey: \"secWaitBanner\",\r\n\t\tlabel: \"Banner ad close delay (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 3,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"secWaitVideo\",\r\n\t\tlabel: \"Video ad skip delay (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 3,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"minAdLengthForSkip\",\r\n\t\tlabel: \"Dont skip video shorter than this (seconds)\",\r\n\t\ttype: \"number\",\r\n\t\tdefault: 0,\r\n\t\tmin: 0,\r\n\t},\r\n\t{\r\n\t\tkey: \"muteEvenIfNotSkipping\",\r\n\t\tlabel: \"Mute video even if not skipping\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: true,\r\n\t},\r\n\t{\r\n\t\tkey: \"debug\",\r\n\t\tlabel: \"Show extra debug information.\",\r\n\t\ttype: \"bool\",\r\n\t\tdefault: false,\r\n\t},\r\n\t{\r\n\t\tkey: \"version\",\r\n\t\ttype: \"hidden\",\r\n\t\tdefault: 1,\r\n\t},\r\n]);\r\n\r\nconst configVersion = 2;\r\nlet conf = config.load();\r\n\r\nconfig.onsave = (cfg) => (conf = cfg);\r\n\r\n// config upgrade procedure\r\nfunction upgradeConfig() {\r\n\tlet lastVersion;\r\n\twhile (conf.version < configVersion && lastVersion !== conf.version) {\r\n\t\tutil.log(\"upgrading config version, current = \", conf.version, \", target = \", configVersion);\r\n\t\tlastVersion = conf.version;\r\n\t\tswitch (conf.version) {\r\n\t\t\tcase 1: {\r\n\t\t\t\tconst oldConf = {\r\n\t\t\t\t\tmuteAd: util.storeGet(\"MUTE_AD\"),\r\n\t\t\t\t\thideAd: util.storeGet(\"HIDE_AD\"),\r\n\t\t\t\t\tsecWait: util.storeGet(\"SEC_WAIT\"),\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (oldConf.muteAd != null) conf.muteAd = !!oldConf.muteAd;\r\n\t\t\t\tif (oldConf.hideAd != null) conf.hideAd = !!oldConf.hideAd;\r\n\t\t\t\tif (oldConf.secWait != null && !isNaN(oldConf.secWait)) conf.secWaitBanner = conf.secWaitVideo = parseInt(oldConf.secWait);\r\n\r\n\t\t\t\tconf.version = 2;\r\n\r\n\t\t\t\tconfig.save(conf);\r\n\t\t\t\t[\"SEC_WAIT\", \"HIDE_AD\", \"MUTE_AD\"].forEach(util.storeDel);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nupgradeConfig();\r\n\r\nfunction createMessageElement() {\r\n\tconst elem = document.createElement(\"div\");\r\n\telem.setAttribute(\"style\", \"border: 1px solid white;border-right: none;background: rgb(0,0,0,0.75);color:white;position: absolute;right: 0;z-index: 1000;top: 10px;padding: 10px;padding-right: 20px;cursor: pointer;pointer-events: all;\");\r\n\treturn elem;\r\n}\r\nfunction showMessage(container, text, ms) {\r\n\tconst message = createMessageElement();\r\n\tmessage.textContent = text;\r\n\tcontainer.appendChild(message);\r\n\tutil.log(`showing message [${ms}ms]: ${text}`);\r\n\tsetTimeout(() => message.remove(), ms);\r\n}\r\n\r\nfunction setupCancelDiv(ad) {\r\n\tconst skipArea = util.q(CSS.preSkipButton, ad);\r\n\tconst skipText = skipArea && skipArea.textContent.trim().replace(/\\s+/g, \" \");\r\n\tif (skipText && ![\"will begin\", \"will play\"].some((snip) => skipText.includes(snip))) {\r\n\t\tconst cancelClass = \"acya-cancel-skip\";\r\n\t\tlet cancelDiv = util.q(\".\" + cancelClass);\r\n\t\tif (cancelDiv) cancelDiv.remove();\r\n\t\tcancelDiv = createMessageElement();\r\n\t\tcancelDiv.className = cancelClass;\r\n\t\tcancelDiv.textContent = (conf.muteAd ? \"Un-mute & \" : \"\") + \"Cancel Auto Skip\";\r\n\t\tcancelDiv.onclick = () => {\r\n\t\t\tutil.log(\"cancel clicked\");\r\n\t\t\tDONT_SKIP = true;\r\n\t\t\tcancelDiv.remove();\r\n\t\t\tconst muteButton = getMuteButton();\r\n\t\t\tconst muteIndicator = getMuteIndicator();\r\n\t\t\tif (conf.muteAd && muteButton && muteIndicator && isMuted(muteIndicator)) muteButton.click();\r\n\t\t};\r\n\t\tad.appendChild(cancelDiv);\r\n\t} else {\r\n\t\tutil.log(\"skip button area wasn't there for some reason.. couldn't place cancel button.\");\r\n\t}\r\n}\r\n\r\nfunction parseTime(str) {\r\n\tconst [minutes, seconds] = str\r\n\t\t.split(\" \")\r\n\t\t.pop()\r\n\t\t.split(\":\")\r\n\t\t.map((num) => parseInt(num));\r\n\tutil.log(str, minutes, seconds);\r\n\treturn minutes * 60 + seconds || 0;\r\n}\r\n\r\nconst getMuteButton = () => util.q(CSS.muteButton);\r\nconst getMuteIndicator = () => util.q(CSS.muteIndicator);\r\nconst isMuted = (m) => m.style.left === \"0px\";\r\n\r\nfunction getAdLength(ad) {\r\n\tif (!ad) return 0;\r\n\tconst time = ad.querySelector(CSS.adLength);\r\n\treturn time ? parseTime(time.textContent) : 0;\r\n}\r\n\r\nfunction waitForAds() {\r\n\tDONT_SKIP = false;\r\n\tTICKS.push(\r\n\t\twaitForElems({\r\n\t\t\tsel: CSS.skipButton,\r\n\t\t\tonmatch: (btn) => {\r\n\t\t\t\tutil.log(\"found skip button\");\r\n\t\t\t\tutil.keepTrying(500, () => {\r\n\t\t\t\t\tif (!btn) return true;\r\n\t\t\t\t\t// if not visible\r\n\t\t\t\t\tif (btn.offsetParent === null) return;\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tif (DONT_SKIP) {\r\n\t\t\t\t\t\t\tutil.log(\"not skipping...\");\r\n\t\t\t\t\t\t\tDONT_SKIP = false;\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tutil.log(\"clicking skip button\");\r\n\t\t\t\t\t\tbtn.click();\r\n\t\t\t\t\t}, conf.secWaitVideo * 1000);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t}),\r\n\t\twaitAndClick(CSS.closeBannerAd, conf.secWaitBanner * 1000),\r\n\t\twaitForElems({\r\n\t\t\tsel: CSS.adArea,\r\n\t\t\tonmatch: (ad) => {\r\n\t\t\t\t// reset don't skip\r\n\t\t\t\tDONT_SKIP = false;\r\n\t\t\t\tconst adLength = getAdLength(ad);\r\n\t\t\t\tconst isShort = adLength < conf.minAdLengthForSkip;\r\n\t\t\t\tconst debug = () => (conf.debug ? `[DEBUG adLength = ${adLength}, minAdLengthForSkip = ${conf.minAdLengthForSkip}]` : \"\");\r\n\t\t\t\tif (isShort && !conf.muteEvenIfNotSkipping) {\r\n\t\t\t\t\tDONT_SKIP = true;\r\n\t\t\t\t\treturn showMessage(ad, `Shot AD detected, will not skip or mute. ${debug()}`, SHORT_AD_MSG_LENGTH);\r\n\t\t\t\t}\r\n\t\t\t\tif (conf.hideAd) {\r\n\t\t\t\t\tad.style.zIndex = 10;\r\n\t\t\t\t\tad.style.background = \"black\";\r\n\t\t\t\t}\r\n\t\t\t\t// show option to cancel automatic skip\r\n\t\t\t\tif (!isShort) setupCancelDiv(ad);\r\n\t\t\t\tif (!conf.muteAd) return;\r\n\t\t\t\tconst muteButton = getMuteButton();\r\n\t\t\t\tconst muteIndicator = getMuteIndicator();\r\n\t\t\t\tif (!muteIndicator) return util.log(\"unable to determine mute state, skipping mute\");\r\n\t\t\t\tmuteButton.click();\r\n\t\t\t\tutil.log(\"Video ad detected, muting audio\");\r\n\t\t\t\t// wait for the ad to disappear before unmuting\r\n\t\t\t\tutil.keepTrying(250, () => {\r\n\t\t\t\t\tif (!util.q(CSS.adArea)) {\r\n\t\t\t\t\t\tif (isMuted(muteIndicator)) {\r\n\t\t\t\t\t\t\tmuteButton.click();\r\n\t\t\t\t\t\t\tutil.log(\"Video ad ended, unmuting audio\");\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tutil.log(\"Video ad ended, audio already unmuted\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (isShort) {\r\n\t\t\t\t\tDONT_SKIP = true;\r\n\t\t\t\t\treturn showMessage(ad, `Short AD detected, will not skip but will mute. ${debug()}`, SHORT_AD_MSG_LENGTH);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t}),\r\n\t);\r\n}\r\n\r\nconst waitAndClick = (sel, ms, cb) =>\r\n\twaitForElems({\r\n\t\tsel: sel,\r\n\t\tonmatch: (btn) => {\r\n\t\t\tutil.log(\"Found ad, closing in\", ms, \"ms\");\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tbtn.click();\r\n\t\t\t\tif (cb) cb(btn);\r\n\t\t\t}, ms);\r\n\t\t},\r\n\t});\r\n\r\nutil.log(\"Started\");\r\n\r\nif (window.self === window.top) {\r\n\tlet videoUrl;\r\n\t// close home ad whenever encountered\r\n\twaitForElems({ sel: CSS.homeAdContainer, onmatch: (ad) => ad.remove() });\r\n\t// wait for video page\r\n\twaitForUrl(/^https:\\/\\/www\\.youtube\\.com\\/watch\\?.*v=.+/, () => {\r\n\t\tif (videoUrl && location.href !== videoUrl) {\r\n\t\t\tutil.log(\"Changed video, removing old wait\");\r\n\t\t\tutil.clearTicks(TICKS);\r\n\t\t}\r\n\t\tvideoUrl = location.href;\r\n\t\tutil.log(\"Entered video, waiting for ads\");\r\n\t\twaitForAds();\r\n\t\tTICKS.push(\r\n\t\t\twaitForUrl(\r\n\t\t\t\t(url) => url !== videoUrl,\r\n\t\t\t\t() => {\r\n\t\t\t\t\tvideoUrl = null;\r\n\t\t\t\t\tutil.clearTicks(TICKS);\r\n\t\t\t\t\tutil.log(\"Left video, stopped waiting for ads\");\r\n\t\t\t\t},\r\n\t\t\t\ttrue,\r\n\t\t\t),\r\n\t\t);\r\n\t});\r\n} else {\r\n\tif (/^https:\\/\\/www\\.youtube\\.com\\/embed\\//.test(location.href)) {\r\n\t\tutil.log(\"Found embedded video, waiting for ads\");\r\n\t\twaitForAds();\r\n\t}\r\n}\r\n\r\nGM_registerMenuCommand(\"Auto Close Youtube Ads - Manage Settings\", config.setup);\r\n"],"names":["CSS","skipButton","preSkipButton","closeBannerAd","muteButton","muteIndicator","adArea","adLength","homeAdContainer","util","log","args","console","SCRIPT_NAME","clearTicks","ticks","forEach","tick","clearInterval","stop","length","keepTrying","wait","action","setInterval","storeGet","key","GM_getValue","value","localStorage","getItem","storeSet","GM_setValue","setItem","storeDel","GM_deleteValue","removeItem","q","query","context","document","querySelector","qq","Array","from","querySelectorAll","get","obj","str","getPath","split","reverse","path","pop","SHORT_AD_MSG_LENGTH","TICKS","DONT_SKIP","config","GM_config","label","type","default","min","configVersion","conf","load","onsave","cfg","upgradeConfig","lastVersion","version","oldConf","muteAd","hideAd","secWait","isNaN","secWaitBanner","secWaitVideo","parseInt","save","createMessageElement","elem","createElement","setAttribute","showMessage","container","text","ms","message","textContent","appendChild","setTimeout","remove","setupCancelDiv","ad","skipArea","skipText","trim","replace","some","snip","includes","cancelClass","cancelDiv","className","onclick","getMuteButton","getMuteIndicator","isMuted","click","parseTime","map","num","minutes","seconds","m","style","left","getAdLength","time","waitForAds","push","waitForElems","sel","onmatch","btn","offsetParent","waitAndClick","isShort","minAdLengthForSkip","debug","muteEvenIfNotSkipping","zIndex","background","cb","window","self","top","videoUrl","waitForUrl","location","href","url","test","GM_registerMenuCommand","setup"],"sourceRoot":""}