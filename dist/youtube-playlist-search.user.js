// ==UserScript==
// @name        YouTube Playlist Search
// @version     2023.228.5233619
// @description Allows you to quickly search through youtube playlists
// @homepage    https://github.com/niubilityfrontend/userscripts#readme
// @supportURL  https://github.com/niubilityfrontend/userscripts/issues
// @match       https://www.youtube.com/*
// @namespace   http://www.fuzetsu.com/YPS
// @require     https://cdn.rawgit.com/fuzetsu/userscripts/477063e939b9658b64d2f91878da20a7f831d98b/wait-for-elements/wait-for-elements.js
// @copyright   2014+, fuzetsu
// @grant       none
// @downloadURL https://gitee.com/tsharp/userscripts/raw/master/dist/youtube-playlist-search.user.js
// @updateURL   https://gitee.com/tsharp/userscripts/raw/master/dist/youtube-playlist-search.meta.js
// ==/UserScript==

(()=>{function t(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||e(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var n="YouTube Playlist Search",o="#contents > ytd-playlist-video-renderer,ytd-grid-video-renderer",i=o+" #progress",a=function(){for(var t,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(t=console).log.apply(t,["%c".concat(n),"font-weight: bold;color: hotpink;"].concat(r))},c=function(t,e){return(e||document).querySelector(t)},u=function(t,e){var r;return function(){for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];clearTimeout(r),r=setTimeout((function(){return t.apply(void 0,o)}),e)}},l=function(t,r){var n=document.createElement(t);return Object.entries(r).forEach((function(t){var r,o,i=(o=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(r,o)||e(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],c=i[1];return!["style"].includes(a)&&a in n?n[a]=c:n.setAttribute(a,c)})),n},s={_items:[],hideWatched:!1,render:function(){var e=["position: fixed","top: ".concat(c("#masthead-container").clientHeight,"px"),"z-index: 9000","padding: 5px 8px","border: 1px solid #999","font-size: medium","color: var(--yt-primary-text-color)","margin: 0","box-sizing: border-box","background: var(--yt-main-app-background-tmp)"],r=l("input",{type:"text",placeholder:"filter - start with ^ for inverse search",style:[].concat(e,["right: 0","width: 300px"]).join(";"),onkeyup:u((function(e){var r;return(r=n).render.apply(r,t(s.search(e.target.value)))}),200)}),n=l("span",{style:[].concat(e,["right: 300px"]).join(";"),textContent:"-"});n.render=function(t,e,r){return n.childNodes[0].textContent="Showing ".concat(t," of ").concat(e," ").concat(r?"(NOT)":""," | Hide Watched ")};var o=l("input",{type:"checkbox",value:s.hideWatched,onchange:function(){var e;return s.hideWatched=o.checked,(e=n).render.apply(e,t(s.search(r.value)))}});return n.appendChild(o),[r,n].forEach((function(t){return document.body.appendChild(t)})),{txtSearch:r,resultCount:n}},search:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=t.startsWith("^");e&&(t=t.slice(1)),t=t.toLowerCase().trim().split(" ").map((function(t){return t.trim()})).filter((function(t){return!!t}));var r=s._items.map((function(r){var n=s.hideWatched&&r.watched,o=n||!t[e?"some":"every"]((function(t){return r.name.includes(t)}));return e&&!n&&(o=!o),r.elem.style.display=o?"none":"",o})).filter((function(t){return!t})).length;return[r,s._items.length,e]},start:function(){a("Starting... waiting for playlist"),waitForUrl(/^https:\/\/www\.youtube\.com\/(playlist\?list=|(user|channel)\/[^\/]+\/videos|feed\/subscriptions).*/,(function(){a("Reached playlist, adding search box");var e=location.href,r=s.render(),n=r.txtSearch,l=r.resultCount,d=u((function(){return l.render.apply(l,t(s.search(n.value)))}),50),f=waitForElems({sel:o,onmatch:function(t){s._items.push({elem:t,name:c("#meta",t).textContent.toLowerCase(),watched:!1}),d()}}),h=waitForElems({sel:i,onmatch:function(t){var e=parseInt(t.style.width)>50;if(e){var r=t.closest(o),n=s._items.find((function(t){return t.elem===r}));if(!n)return console.log("error, unable to find item parent",t,r,n);n.watched=e,s.hideWatched&&e&&d()}}}),p=waitForUrl((function(t){return t!==e}),(function(){a("leaving playlist, cleaning up"),[h,f,p].forEach((function(t){return t.stop&&t.stop()||clearInterval(t)})),[n,l].forEach((function(t){return t.remove()})),s._items=[]}),!0)}))}};s.start()})();
//# sourceMappingURL=youtube-playlist-search.user.js.map