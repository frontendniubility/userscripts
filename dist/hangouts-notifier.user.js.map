{"version":3,"file":"hangouts-notifier.user.js","mappings":"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","sources":["webpack://userscripts/./src/hangouts-notifier/hangouts-notifier.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         Hangouts Notifier\r\n// @namespace    fuzetsu.com/HangoutsNotifier\r\n// @version      0.0.9\r\n// @description  Show desktop notifications for the Hangouts web app\r\n// @author       fuzetsu\r\n// @match        https://hangouts.google.com/webchat/*\r\n// @grant        none\r\n// @deprecated   true\r\n// ==/UserScript==\r\n/* jshint -W097 */\r\n'use strict';\r\n\r\nvar util = {\r\n    log: function () {\r\n        var args = [].slice.call(arguments);\r\n        args.unshift('%c' + SCRIPT_NAME + ':', 'font-weight: bold;color: purple;');\r\n        console.log.apply(console, args);\r\n    },\r\n    q: function (query, context) {\r\n        return (context || document).querySelector(query);\r\n    },\r\n    qq: function (query, context) {\r\n        return [].slice.call((context || document).querySelectorAll(query));\r\n    }\r\n};\r\n\r\nvar SCRIPT_NAME = 'Hangouts Notifier';\r\nvar LAST_MESSAGE = '.tk.Sn';\r\nvar MESSAGE_TEXT = '.Mu:last-child';\r\nvar USER_IMAGE = 'img.Yf';\r\nvar NEW_MSG = '.Ik.uB';\r\nvar CHECK_INTERVAL = 1 * 1000;\r\nvar NOTIFY_HIDE_DELAY = 6 * 1000;\r\nvar NOTIFY_EXPIRE = 1 * 60 * 1000;\r\n\r\nvar hn = {\r\n    checkPermissions: function () {\r\n        return Notification.requestPermission(function (permission) {\r\n            util.log('permission', permission);\r\n        });\r\n    },\r\n    notification: function (title, opt) {\r\n        var n = new Notification(title, opt);\r\n        var id = setTimeout(function () {\r\n            n.close();\r\n        }, NOTIFY_EXPIRE);\r\n        n.onclick = function () {\r\n            clearTimeout(id);\r\n            n.close();\r\n            window.focus();\r\n        };\r\n        n.onshow = function () {\r\n            clearTimeout(id);\r\n            setTimeout(function () {\r\n                n.close();\r\n            }, NOTIFY_HIDE_DELAY);\r\n        };\r\n    },\r\n    notify: function (user, msg, img) {\r\n        if (!('Notification' in window)) {\r\n            alert('This browser does not support desktop notifications...');\r\n            return;\r\n        }\r\n        var title = user;\r\n        var opt = {\r\n            body: msg,\r\n            icon: img || 'https://cdn4.iconfinder.com/data/icons/miu-shadow-social/48/hangouts-128.png'\r\n        };\r\n        if (Notification.permission === 'granted') {\r\n            hn.notification(title, opt);\r\n        } else if (Notification.permission !== 'denied') {\r\n            return Notification.requestPermission(function (permission) {\r\n                if (permission === 'granted') {\r\n                    hn.notification(title, opt);\r\n                }\r\n            });\r\n        }\r\n    },\r\n    getLastMessage: function () {\r\n        var message = util.qq(LAST_MESSAGE).pop();\r\n        if (!message) return;\r\n        var user = util.q(USER_IMAGE, message);\r\n        message = util.q(MESSAGE_TEXT, message);\r\n        if (!message) return;\r\n        return {\r\n            user: user.alt,\r\n            id: message.id,\r\n            text: message.textContent,\r\n            img: user.src.replace(/\\/s32[^\\/]*\\//, '/s128/')\r\n        };\r\n    },\r\n    start: function () {\r\n        util.log('Starting...', location.href);\r\n        var lastId = null;\r\n        var res = hn.getLastMessage();\r\n        if (!res) {\r\n            util.log('failed to get last message, this probably  isn\\'t a hangouts chat window...');\r\n            if (document.URL.indexOf('prop=gmail#epreld') >= 0) {\r\n                util.log('So it may be a hangouts chat window, after all...');\r\n                res = {\r\n                    id: -1\r\n                };\r\n            } else {\r\n                return false;\r\n            }\r\n        }\r\n        // if window is focused set last message as read\r\n        if (document.hasFocus() || !util.q(NEW_MSG)) {\r\n            lastId = res.id;\r\n        }\r\n        setInterval(function () {\r\n            res = hn.getLastMessage();\r\n            if (res && res.id !== lastId) {\r\n                lastId = res.id;\r\n                if (!document.hasFocus() && util.q(NEW_MSG)) {\r\n                    hn.notify(res.user, res.text, res.img);\r\n                }\r\n            }\r\n        }, CHECK_INTERVAL);\r\n        return true;\r\n    }\r\n};\r\n\r\nhn.checkPermissions();\r\nif (!hn.start()) {\r\n    util.log('trying again in 5 seconds, just in case');\r\n    setTimeout(hn.start, 5000);\r\n}"],"names":["util","log","args","slice","call","arguments","unshift","SCRIPT_NAME","console","apply","q","query","context","document","querySelector","qq","querySelectorAll","LAST_MESSAGE","MESSAGE_TEXT","USER_IMAGE","NEW_MSG","CHECK_INTERVAL","NOTIFY_HIDE_DELAY","NOTIFY_EXPIRE","hn","checkPermissions","Notification","requestPermission","permission","notification","title","opt","n","id","setTimeout","close","onclick","clearTimeout","window","focus","onshow","notify","user","msg","img","alert","body","icon","getLastMessage","message","pop","alt","text","textContent","src","replace","start","location","href","lastId","res","URL","indexOf","hasFocus","setInterval"],"sourceRoot":""}