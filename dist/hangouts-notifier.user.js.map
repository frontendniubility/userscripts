{"version":3,"file":"hangouts-notifier.user.js","mappings":";;;IAWa,IAETA,OAAO;QACPC,KAAK,SAAAA;YACD,IAAIC,OAAO,GAAGC,MAAMC,KAAKC;YACzBH,KAAKI,QAAQ,OAAOC,cAAc,KAAK;YACvCC,QAAQP,IAAIQ,MAAMD,SAASN;AAC/B;QACAQ,GAAG,SAAAA,EAAUC,OAAOC;YAChB,QAAQA,WAAWC,UAAUC,cAAcH;AAC/C;QACAI,IAAI,SAAAA,GAAUJ,OAAOC;YACjB,OAAO,GAAGT,MAAMC,MAAMQ,WAAWC,UAAUG,iBAAiBL;AAChE;OAGAJ,cAAc,qBACdU,eAAe,UACfC,eAAe,kBACfC,aAAa,UACbC,UAAU,UACVC,iBAAiB,IAAI,KACrBC,oBAAoB,IAAI,KACxBC,gBAAgB,IAAI,KAAK,KAEzBC,KAAK;QACLC,kBAAkB,SAAAA;YACd,OAAOC,aAAaC,mBAAkB,SAAUC;gBAC5C5B,KAAKC,IAAI,cAAc2B;AAC3B;AACJ;QACAC,cAAc,SAAAA,aAAUC,OAAOC;YAAK,IAC5BC,IAAI,IAAIN,aAAaI,OAAOC,MAC5BE,KAAKC,YAAW;gBAChBF,EAAEG;AACN,gBAAGZ;YACHS,EAAEI,UAAU;gBACRC,aAAaJ;gBACbD,EAAEG;gBACFG,OAAOC;AACX;YACAP,EAAEQ,SAAS;gBACPH,aAAaJ;gBACbC,YAAW;oBACPF,EAAEG;AACN,oBAAGb;AACP;AACJ;QACAmB,QAAQ,SAAAA,OAAUC,MAAMC,KAAKC;YACzB,MAAM,kBAAkBN,SAAS;gBAC7BO,MAAM;gBACN;AACJ;YAAC,IACGf,QAAQY,MACRX,MAAM;gBACNe,MAAMH;gBACNI,MAAMH,OAAO;;YAEjB,IAAIlB,aAAaE,eAAe,WAAW;gBACvCJ,GAAGK,aAAaC,OAAOC;AAC3B,mBAAO,IAAIL,aAAaE,eAAe,UAAU;gBAC7C,OAAOF,aAAaC,mBAAkB,SAAUC;oBAC5C,IAAIA,eAAe,WAAW;wBAC1BJ,GAAGK,aAAaC,OAAOC;AAC3B;AACJ;AACJ;AACJ;QACAiB,gBAAgB,SAAAA;YACZ,IAAIC,UAAUjD,KAAKe,GAAGE,cAAciC;YACpC,KAAKD,SAAS;YACd,IAAIP,OAAO1C,KAAKU,EAAES,YAAY8B;YAC9BA,UAAUjD,KAAKU,EAAEQ,cAAc+B;YAC/B,KAAKA,SAAS;YACd,OAAO;gBACHP,MAAMA,KAAKS;gBACXlB,IAAIgB,QAAQhB;gBACZmB,MAAMH,QAAQI;gBACdT,KAAKF,KAAKY,IAAIC,QAAQ,iBAAiB;;AAE/C;QACAC,OAAO,SAAAA;YACHxD,KAAKC,IAAI,eAAewD,SAASC;YAAM,IACnCC,SAAS,MACTC,MAAMpC,GAAGwB;YACb,KAAKY,KAAK;gBACN5D,KAAKC,IAAI;gBACT,IAAIY,SAASgD,IAAIC,QAAQ,wBAAwB,GAAG;oBAChD9D,KAAKC,IAAI;oBACT2D,MAAM;wBACF3B,KAAK;;AAEb,uBAAO;oBACH,OAAO;AACX;AACJ;YAEA,IAAIpB,SAASkD,eAAe/D,KAAKU,EAAEU,UAAU;gBACzCuC,SAASC,IAAI3B;AACjB;YACA+B,aAAY;gBACRJ,MAAMpC,GAAGwB;gBACT,IAAIY,OAAOA,IAAI3B,OAAO0B,QAAQ;oBAC1BA,SAASC,IAAI3B;oBACb,KAAKpB,SAASkD,cAAc/D,KAAKU,EAAEU,UAAU;wBACzCI,GAAGiB,OAAOmB,IAAIlB,MAAMkB,IAAIR,MAAMQ,IAAIhB;AACtC;AACJ;AACJ,gBAAGvB;YACH,OAAO;AACX;;IAGJG,GAAGC;IACH,KAAKD,GAAGgC,SAAS;QACbxD,KAAKC,IAAI;QACTiC,WAAWV,GAAGgC,OAAO;AACzB","sources":["webpack://userscripts/./src/hangouts-notifier/hangouts-notifier.user.js"],"sourcesContent":["// ==UserScript==\r\n// @name         Hangouts Notifier\r\n// @namespace    fuzetsu.com/HangoutsNotifier\r\n// @version      0.0.9\r\n// @description  Show desktop notifications for the Hangouts web app\r\n// @author       fuzetsu\r\n// @match        https://hangouts.google.com/webchat/*\r\n// @grant        none\r\n// @deprecated   true\r\n// ==/UserScript==\r\n/* jshint -W097 */\r\n'use strict';\r\n\r\nvar util = {\r\n    log: function () {\r\n        var args = [].slice.call(arguments);\r\n        args.unshift('%c' + SCRIPT_NAME + ':', 'font-weight: bold;color: purple;');\r\n        console.log.apply(console, args);\r\n    },\r\n    q: function (query, context) {\r\n        return (context || document).querySelector(query);\r\n    },\r\n    qq: function (query, context) {\r\n        return [].slice.call((context || document).querySelectorAll(query));\r\n    }\r\n};\r\n\r\nvar SCRIPT_NAME = 'Hangouts Notifier';\r\nvar LAST_MESSAGE = '.tk.Sn';\r\nvar MESSAGE_TEXT = '.Mu:last-child';\r\nvar USER_IMAGE = 'img.Yf';\r\nvar NEW_MSG = '.Ik.uB';\r\nvar CHECK_INTERVAL = 1 * 1000;\r\nvar NOTIFY_HIDE_DELAY = 6 * 1000;\r\nvar NOTIFY_EXPIRE = 1 * 60 * 1000;\r\n\r\nvar hn = {\r\n    checkPermissions: function () {\r\n        return Notification.requestPermission(function (permission) {\r\n            util.log('permission', permission);\r\n        });\r\n    },\r\n    notification: function (title, opt) {\r\n        var n = new Notification(title, opt);\r\n        var id = setTimeout(function () {\r\n            n.close();\r\n        }, NOTIFY_EXPIRE);\r\n        n.onclick = function () {\r\n            clearTimeout(id);\r\n            n.close();\r\n            window.focus();\r\n        };\r\n        n.onshow = function () {\r\n            clearTimeout(id);\r\n            setTimeout(function () {\r\n                n.close();\r\n            }, NOTIFY_HIDE_DELAY);\r\n        };\r\n    },\r\n    notify: function (user, msg, img) {\r\n        if (!('Notification' in window)) {\r\n            alert('This browser does not support desktop notifications...');\r\n            return;\r\n        }\r\n        var title = user;\r\n        var opt = {\r\n            body: msg,\r\n            icon: img || 'https://cdn4.iconfinder.com/data/icons/miu-shadow-social/48/hangouts-128.png'\r\n        };\r\n        if (Notification.permission === 'granted') {\r\n            hn.notification(title, opt);\r\n        } else if (Notification.permission !== 'denied') {\r\n            return Notification.requestPermission(function (permission) {\r\n                if (permission === 'granted') {\r\n                    hn.notification(title, opt);\r\n                }\r\n            });\r\n        }\r\n    },\r\n    getLastMessage: function () {\r\n        var message = util.qq(LAST_MESSAGE).pop();\r\n        if (!message) return;\r\n        var user = util.q(USER_IMAGE, message);\r\n        message = util.q(MESSAGE_TEXT, message);\r\n        if (!message) return;\r\n        return {\r\n            user: user.alt,\r\n            id: message.id,\r\n            text: message.textContent,\r\n            img: user.src.replace(/\\/s32[^\\/]*\\//, '/s128/')\r\n        };\r\n    },\r\n    start: function () {\r\n        util.log('Starting...', location.href);\r\n        var lastId = null;\r\n        var res = hn.getLastMessage();\r\n        if (!res) {\r\n            util.log('failed to get last message, this probably  isn\\'t a hangouts chat window...');\r\n            if (document.URL.indexOf('prop=gmail#epreld') >= 0) {\r\n                util.log('So it may be a hangouts chat window, after all...');\r\n                res = {\r\n                    id: -1\r\n                };\r\n            } else {\r\n                return false;\r\n            }\r\n        }\r\n        // if window is focused set last message as read\r\n        if (document.hasFocus() || !util.q(NEW_MSG)) {\r\n            lastId = res.id;\r\n        }\r\n        setInterval(function () {\r\n            res = hn.getLastMessage();\r\n            if (res && res.id !== lastId) {\r\n                lastId = res.id;\r\n                if (!document.hasFocus() && util.q(NEW_MSG)) {\r\n                    hn.notify(res.user, res.text, res.img);\r\n                }\r\n            }\r\n        }, CHECK_INTERVAL);\r\n        return true;\r\n    }\r\n};\r\n\r\nhn.checkPermissions();\r\nif (!hn.start()) {\r\n    util.log('trying again in 5 seconds, just in case');\r\n    setTimeout(hn.start, 5000);\r\n}"],"names":["util","log","args","slice","call","arguments","unshift","SCRIPT_NAME","console","apply","q","query","context","document","querySelector","qq","querySelectorAll","LAST_MESSAGE","MESSAGE_TEXT","USER_IMAGE","NEW_MSG","CHECK_INTERVAL","NOTIFY_HIDE_DELAY","NOTIFY_EXPIRE","hn","checkPermissions","Notification","requestPermission","permission","notification","title","opt","n","id","setTimeout","close","onclick","clearTimeout","window","focus","onshow","notify","user","msg","img","alert","body","icon","getLastMessage","message","pop","alt","text","textContent","src","replace","start","location","href","lastId","res","URL","indexOf","hasFocus","setInterval"],"sourceRoot":""}